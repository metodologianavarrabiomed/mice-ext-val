<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example Of Use With Dichotomous Outcome • MiceExtVal</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="get-started-logreg_files/libs/quarto-html/popper.min.js"></script><script src="get-started-logreg_files/libs/quarto-html/tippy.umd.min.js"></script><link href="get-started-logreg_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="get-started-logreg_files/libs/quarto-html/light-border.css" rel="stylesheet">
<script src="get-started-logreg_files/libs/kePrint-0.0.1/kePrint.js"></script><link href="get-started-logreg_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example Of Use With Dichotomous Outcome">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MiceExtVal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/get-started-logreg.html">Example Of Use With Dichotomous Outcome</a></li>
    <li><a class="dropdown-item" href="../articles/get-started-surv.html">Example Of Use With Survival Outcome</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/metodologianavarrabiomed/mice-ext-val/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Example Of Use With Dichotomous Outcome</h1>

      <p class="author">Asier Ballesteros Domínguez</p>


      <small class="dont-index">Source: <a href="https://github.com/metodologianavarrabiomed/mice-ext-val/blob/master/vignettes/get-started-logreg.qmd" class="external-link"><code>vignettes/get-started-logreg.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <div class="cell">
<style type="text/css">
p {
  text-align: justify
}
</style>
</div>
<section class="section level5"><h5 id="required-libraries">Required Libraries<a class="anchor" aria-label="anchor" href="#required-libraries"></a>
</h5>
<p>The following code snippet lists all the libraries needed to run this report.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://metodologianavarrabiomed.github.io/mice-ext-val">MiceExtVal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ddsjoberg/gtsummary" class="external-link">gtsummary</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span></code></pre></div>
</div>
<p>The <code>MiceExtVal</code> package is designed to facilitate the external validation of prediction models, particularly in clinical research settings. In this vignette, we illustrate its use by replicating a well-known example from <span class="citation" data-cites="steyerberg">Steyerberg (<a href="#ref-steyerberg" role="doc-biblioref">2019</a>)</span>, presented in Chapter 20 of his book. Specifically, we demonstrate how to externally validate the TIMI-II model, originally developed by <span class="citation" data-cites="timi-ii">Mueller et al. (<a href="#ref-timi-ii" role="doc-biblioref">1992</a>)</span>, using data from the Western region cohort of the GUSTO-I trial. This dataset is included in the package as <code><a href="../reference/gusto.html">MiceExtVal::gusto</a></code>.</p>
<p>The TIMI-II model is a logistic regression model that predicts 42-day mortality in patients with acute myocardial infarction. Our aim is to assess the model’s performance in a new population—patients in the GUSTO-I Western region cohort, which provides only 30 days of follow-up. Through this example, users will learn how the MiceExtVal package supports the evaluation of model transportability and predictive accuracy across different clinical settings.</p>
<div id="tbl-timi-ii" class="plain table-sm quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-timi-ii-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 1: TIMI-II coefficients
</figcaption><div aria-describedby="tbl-timi-ii-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table plain table-sm small caption-top">
<thead><tr class="header">
<th style="text-align: left;">Predictor</th>
<th style="text-align: right;">Coefficient</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Shock</td>
<td style="text-align: right;">1.79</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age &gt; 65</td>
<td style="text-align: right;">0.99</td>
</tr>
<tr class="odd">
<td style="text-align: left;">High risk</td>
<td style="text-align: right;">0.92</td>
</tr>
<tr class="even">
<td style="text-align: left;">Diabetes</td>
<td style="text-align: right;">0.74</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hypotension</td>
<td style="text-align: right;">0.69</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tachycardia</td>
<td style="text-align: right;">0.59</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Time to relief</td>
<td style="text-align: right;">0.53</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sex</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Intercept</td>
<td style="text-align: right;">-4.47</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section><section class="section level2"><h2 id="explore-the-dataset">Explore the dataset<a class="anchor" aria-label="anchor" href="#explore-the-dataset"></a>
</h2>
<p>The first step in any data analysis or validation project is to become familiar with the dataset. The MiceExtVal package includes the GUSTO-I Western region dataset, which is also used in the example from <span class="citation" data-cites="steyerberg">Steyerberg (<a href="#ref-steyerberg" role="doc-biblioref">2019</a>)</span>. To illustrate the use of multiple imputation — a key requirement of the package — we provide a modified version of the dataset with artificially introduced missing values. This setup allows users to work through a realistic example where incomplete data must be addressed.</p>
<p><a href="#tbl-gusto-sum" class="quarto-xref">Table 2</a> presents a descriptive summary of the dataset. Notably, the cohort includes nearly three times as many men as women. While most variables appear similar across sexes, there is a marked difference in mortality rates: <span class="math inline">\(11\%\)</span> in women compared to <span class="math inline">\(4.7\%\)</span> in men. This disparity may be partially explained by age, as <span class="math inline">\(57\%\)</span> of the female patients are over <span class="math inline">\(65\)</span> years old, compared to only <span class="math inline">\(32\%\)</span> of the male patients. As previously mentioned, missing values are distributed across most variables in a similar pattern, and will need to be handled appropriately during the validation process.</p>
<div class="cell plain table-sm">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gusto</span> <span class="op">&lt;-</span> <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="va"><a href="../reference/gusto.html">gusto</a></span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gusto</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    sex <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">sex</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"Male"</span>, <span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Female"</span>,</span>
<span>      .default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">gtsummary</span><span class="fu">::</span><span class="fu"><a href="https://www.danieldsjoberg.com/gtsummary/reference/tbl_summary.html" class="external-link">tbl_summary</a></span><span class="op">(</span></span>
<span>    by <span class="op">=</span> <span class="st">"sex"</span>,</span>
<span>    missing_text <span class="op">=</span> <span class="st">"% of missings"</span>,</span>
<span>    missing_stat <span class="op">=</span> <span class="st">"{p_miss}%"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div id="tbl-gusto-sum" class="cell plain table-sm quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-gusto-sum-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 2: GUSTO-I W region dataset descriptive table
</figcaption><div aria-describedby="tbl-gusto-sum-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="gdcedluxuy" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#gdcedluxuy table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#gdcedluxuy thead, #gdcedluxuy tbody, #gdcedluxuy tfoot, #gdcedluxuy tr, #gdcedluxuy td, #gdcedluxuy th {
  border-style: none;
}

#gdcedluxuy p {
  margin: 0;
  padding: 0;
}

#gdcedluxuy .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gdcedluxuy .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#gdcedluxuy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gdcedluxuy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gdcedluxuy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gdcedluxuy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gdcedluxuy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gdcedluxuy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gdcedluxuy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gdcedluxuy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gdcedluxuy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gdcedluxuy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gdcedluxuy .gt_spanner_row {
  border-bottom-style: hidden;
}

#gdcedluxuy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#gdcedluxuy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gdcedluxuy .gt_from_md > :first-child {
  margin-top: 0;
}

#gdcedluxuy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gdcedluxuy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gdcedluxuy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gdcedluxuy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gdcedluxuy .gt_row_group_first td {
  border-top-width: 2px;
}

#gdcedluxuy .gt_row_group_first th {
  border-top-width: 2px;
}

#gdcedluxuy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gdcedluxuy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gdcedluxuy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gdcedluxuy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gdcedluxuy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gdcedluxuy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gdcedluxuy .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#gdcedluxuy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gdcedluxuy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gdcedluxuy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gdcedluxuy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gdcedluxuy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gdcedluxuy .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gdcedluxuy .gt_left {
  text-align: left;
}

#gdcedluxuy .gt_center {
  text-align: center;
}

#gdcedluxuy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gdcedluxuy .gt_font_normal {
  font-weight: normal;
}

#gdcedluxuy .gt_font_bold {
  font-weight: bold;
}

#gdcedluxuy .gt_font_italic {
  font-style: italic;
}

#gdcedluxuy .gt_super {
  font-size: 65%;
}

#gdcedluxuy .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#gdcedluxuy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gdcedluxuy .gt_indent_1 {
  text-indent: 5px;
}

#gdcedluxuy .gt_indent_2 {
  text-indent: 10px;
}

#gdcedluxuy .gt_indent_3 {
  text-indent: 15px;
}

#gdcedluxuy .gt_indent_4 {
  text-indent: 20px;
}

#gdcedluxuy .gt_indent_5 {
  text-indent: 25px;
}

#gdcedluxuy .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#gdcedluxuy div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table do-not-create-environment cell plain table-sm small caption-top" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead><tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="stat_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">
<strong>Female</strong><br>
N = 544<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span>
</th>
<th id="stat_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">
<strong>Male</strong><br>
N = 1,644<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span>
</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">Shock: Killip class 3/4 vs. 1/2</td>
<td class="gt_row gt_center" headers="stat_1">5 (1.0%)</td>
<td class="gt_row gt_center" headers="stat_2">25 (1.6%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    % of missings</td>
<td class="gt_row gt_center" headers="stat_1">7.9%</td>
<td class="gt_row gt_center" headers="stat_2">6.3%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">If the patient is older than 65 years old</td>
<td class="gt_row gt_center" headers="stat_1">287 (57%)</td>
<td class="gt_row gt_center" headers="stat_2">496 (32%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    % of missings</td>
<td class="gt_row gt_center" headers="stat_1">8.1%</td>
<td class="gt_row gt_center" headers="stat_2">6.9%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Diagnosed diabetes</td>
<td class="gt_row gt_center" headers="stat_1">77 (15%)</td>
<td class="gt_row gt_center" headers="stat_2">208 (14%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    % of missings</td>
<td class="gt_row gt_center" headers="stat_1">6.4%</td>
<td class="gt_row gt_center" headers="stat_2">6.4%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Categorized for high risk of Anterior Infart Location or Prevous Myocardial Infarction</td>
<td class="gt_row gt_center" headers="stat_1">226 (46%)</td>
<td class="gt_row gt_center" headers="stat_2">755 (49%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    % of missings</td>
<td class="gt_row gt_center" headers="stat_1">8.8%</td>
<td class="gt_row gt_center" headers="stat_2">6.6%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Hypotension: Systolic Blood Pressure &lt; 100 mmHg</td>
<td class="gt_row gt_center" headers="stat_1">63 (12%)</td>
<td class="gt_row gt_center" headers="stat_2">133 (8.7%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    % of missings</td>
<td class="gt_row gt_center" headers="stat_1">6.8%</td>
<td class="gt_row gt_center" headers="stat_2">7.0%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Heart rate: Pulse&gt;80 (Tachycardia)</td>
<td class="gt_row gt_center" headers="stat_1">192 (38%)</td>
<td class="gt_row gt_center" headers="stat_2">496 (32%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    % of missings</td>
<td class="gt_row gt_center" headers="stat_1">7.4%</td>
<td class="gt_row gt_center" headers="stat_2">6.9%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Time to relief of chest pain &gt; 1h</td>
<td class="gt_row gt_center" headers="stat_1">295 (59%)</td>
<td class="gt_row gt_center" headers="stat_2">943 (62%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    % of missings</td>
<td class="gt_row gt_center" headers="stat_1">8.8%</td>
<td class="gt_row gt_center" headers="stat_2">7.1%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">30 day mortality</td>
<td class="gt_row gt_center" headers="stat_1">58 (11%)</td>
<td class="gt_row gt_center" headers="stat_2">77 (4.7%)</td>
</tr>
</tbody>
<tfoot><tr class="gt_footnotes odd">
<td colspan="3" class="gt_footnote">
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> n (%)</td>
</tr></tfoot>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
</section><section class="section level2"><h2 id="handling-missing-data">Handling Missing Data<a class="anchor" aria-label="anchor" href="#handling-missing-data"></a>
</h2>
<p>Although the main objective of this vignette is to demonstrate the use of the MiceExtVal package for external model validation, addressing missing data is a necessary step—and one that reflects best practices in clinical research. Multiple imputation is widely recommended as a statistically sound method for handling missing values, as it preserves power and reduces bias compared to simpler approaches like complete case analysis, <span class="citation" data-cites="vanBuuren2018">Buuren (<a href="#ref-vanBuuren2018" role="doc-biblioref">2018</a>)</span>.</p>
<p>The <code>MiceExtVal</code> package is built to integrate seamlessly with workflows that use multiple imputation. In fact, all of its core functions expect the input data to be provided in long format, as produced by the <code>mice</code> package <span class="citation" data-cites="mice-package">van Buuren &amp; Groothuis-Oudshoorn (<a href="#ref-mice-package" role="doc-biblioref">2011</a>)</span>.</p>
<p>Below, we present a basic example using <code>mice</code> to perform multiple imputation. We first construct a predictor matrix, excluding the <code>id</code> variable, and then extract the imputed datasets in long format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_matrix</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://amices.org/mice/reference/make.predictorMatrix.html" class="external-link">make.predictorMatrix</a></span><span class="op">(</span><span class="va">gusto</span><span class="op">)</span></span>
<span><span class="va">pred_matrix</span><span class="op">[</span>, <span class="st">"id"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">gusto_imp</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">gusto</span>, predictorMatrix <span class="op">=</span> <span class="va">pred_matrix</span>, seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span><span class="st">"long"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The resulting object, <code>gusto_imp</code>, contains the multiply imputed datasets stacked in long format. This structure is required for proper functioning of the <code>MiceExtVal</code> package.</p>
<p>For a more comprehensive discussion on multiple imputation methodology and its practical application, we refer readers to Flexible Imputation of Missing Data by <span class="citation" data-cites="vanBuuren2018">Buuren (<a href="#ref-vanBuuren2018" role="doc-biblioref">2018</a>)</span>, and to the original mice package paper by <span class="citation" data-cites="mice-package">van Buuren &amp; Groothuis-Oudshoorn (<a href="#ref-mice-package" role="doc-biblioref">2011</a>)</span>.</p>
</section><section class="section level2"><h2 id="external-validation">External Validation<a class="anchor" aria-label="anchor" href="#external-validation"></a>
</h2>
<p>Traditional external validation is typically performed on a single, complete dataset and involves several sequential steps. First, the original model is used to generate predictions for the new dataset. Then, the model’s performance is evaluated by assessing its discrimination (e.g., AUC) and calibration. If necessary, the model may be recalibrated, and performance metrics re-evaluated after adjustment.</p>
<p>However, when working with datasets containing missing values—especially in clinical research—multiple imputation is often used to preserve data integrity and avoid bias. As a result, we no longer have a single dataset, but multiple imputed versions of the original data, each representing a plausible completion. This complicates traditional validation workflows, since each imputed dataset yields different results that must be pooled appropriately.</p>
<p>The <code>MiceExtVal</code> package is designed to bridge this gap by streamlining the external validation process across multiple imputed datasets. It allows users to perform all validation steps—including prediction, performance evaluation, and optional recalibration while properly handling the variability introduced by imputation.</p>
<p>Having completed the imputation in the previous section, we are now ready to externally validate the TIMI-II model using <code>MiceExtVal</code>. Since TIMI-II is a logistic regression model, we begin by defining it with the <code><a href="../reference/mv_model_logreg.html">MiceExtVal::mv_model_logreg()</a></code> function. This function requires a formula specifying the model’s coefficients and intercept. It is essential that all variables included in the formula are present in the imputed dataset; otherwise, subsequent functions will raise an error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timi2_model</span> <span class="op">&lt;-</span> <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/mv_model_logreg.html">mv_model_logreg</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">day30</span> <span class="op">~</span> <span class="fl">1.79</span> <span class="op">*</span> <span class="va">sho</span> <span class="op">+</span> <span class="fl">0.99</span> <span class="op">*</span> <span class="va">a65</span> <span class="op">+</span> <span class="fl">0.92</span> <span class="op">*</span> <span class="va">hig</span> <span class="op">+</span> <span class="fl">0.74</span> <span class="op">*</span> <span class="va">dia</span> <span class="op">+</span></span>
<span>    <span class="fl">0.69</span> <span class="op">*</span> <span class="va">hyp</span> <span class="op">+</span> <span class="fl">0.59</span> <span class="op">*</span> <span class="va">hrt</span> <span class="op">+</span> <span class="fl">0.53</span> <span class="op">*</span> <span class="va">ttr</span> <span class="op">+</span> <span class="fl">0.47</span> <span class="op">*</span> <span class="va">sex</span> <span class="op">-</span> <span class="fl">4.47</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Once the model is defined using <code><a href="../reference/mv_model_logreg.html">MiceExtVal::mv_model_logreg()</a></code>, the resulting object—stored in timi2_model—contains both the model formula and the structural skeleton needed for subsequent steps. Most functions in the <code>MiceExtVal</code> package take this model object as input and return an updated version with additional components, such as predictions or performance metrics. These functions follow a consistent naming convention: those that modify the model object begin with the prefix calculate_.</p>
<p>The first step in the external validation process is to compute the model’s original predictions on the external dataset. To do this, the package provides the <code><a href="../reference/calculate_predictions.html">MiceExtVal::calculate_predictions()</a></code> function. This function requires two arguments: the model object (e.g., <code>timi2_model</code>) and the imputed dataset in long format (e.g., <code>gusto_imp</code>). It returns the same model object with the predicted probabilities added, ready for subsequent validation steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timi2_model</span> <span class="op">&lt;-</span> <span class="va">timi2_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions.html">calculate_predictions</a></span><span class="op">(</span><span class="va">gusto_imp</span><span class="op">)</span></span></code></pre></div>
</div>
<p>After executing <code><a href="../reference/calculate_predictions.html">MiceExtVal::calculate_predictions()</a></code>, the model object is updated with additional information derived from the imputed dataset. Specifically, the predicted probabilities are computed for each imputation and stored within the model. In addition, the function calculates aggregated predictions for each patient by pooling results across imputations. An example of these values are shown in <a href="#tbl-model-predictions-example" class="quarto-xref">Table 3</a>.</p>
<p>Beyond the predicted probabilities, the model object also includes the linear predictors (<span class="math inline">\(\beta \cdot X\)</span>), both at the individual imputation level and as pooled estimates. These represent the raw score from the logistic regression model before applying the inverse logit transformation. <a href="#tbl-model-betax-example" class="quarto-xref">Table 4</a> presents these values.</p>
<p>This structure—where all relevant prediction outputs are integrated into the model object—allows for a streamlined workflow in which subsequent steps like performance evaluation or recalibration can be carried out with minimal additional input.</p>
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timi2_model</span><span class="op">$</span><span class="va">predictions_aggregated</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">timi2_model</span><span class="op">$</span><span class="va">predictions_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="tbl-model-predictions-example" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-model-predictions-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 3: Model predictions
</figcaption><div aria-describedby="tbl-model-predictions-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-model-predictions-example" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-model-predictions-example-1" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-model-predictions-example-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Aggregated predictions
</figcaption><div aria-describedby="tbl-model-predictions-example-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-model-predictions-example-1" class="table do-not-create-environment caption-top">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">prediction</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.1160889</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0650227</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.0202330</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0816603</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0373269</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.0407286</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-model-predictions-example" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-model-predictions-example-2" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-model-predictions-example-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Model predictions in each imputation
</figcaption><div aria-describedby="tbl-model-predictions-example-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-model-predictions-example-2" class="table do-not-create-environment caption-top">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">prediction</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">.imp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.1160889</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.0567862</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.0202330</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.0816603</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.0373269</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.0492660</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timi2_model</span><span class="op">$</span><span class="va">betax</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">timi2_model</span><span class="op">$</span><span class="va">betax_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="tbl-model-betax-example" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-model-betax-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 4: Model Beta X
</figcaption><div aria-describedby="tbl-model-betax-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-model-betax-example" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-model-betax-example-1" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-model-betax-example-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Aggregated Beta X
</figcaption><div aria-describedby="tbl-model-betax-example-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-model-betax-example-1" class="table do-not-create-environment caption-top">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">betax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">-2.030</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">-2.692</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">-3.880</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">-2.420</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">-3.250</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">-3.196</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-model-betax-example" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-model-betax-example-2" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-model-betax-example-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Model Beta X in each imputation
</figcaption><div aria-describedby="tbl-model-betax-example-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-model-betax-example-2" class="table do-not-create-environment caption-top">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">betax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">.imp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-2.03</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">-2.81</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-3.88</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">-2.42</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-3.25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">-2.96</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<section class="level2"><h3 id="performance-assessment">Performance Assessment<a class="anchor" aria-label="anchor" href="#performance-assessment"></a>
</h3>
<p>Once the model predictions have been calculated, we can proceed to assess the model’s performance on the external cohort. The first aspect of performance we evaluate is discrimination, which reflects the model’s ability to distinguish between patients who experienced the event and those who did not.</p>
<p>The <code>MiceExtVal</code> package provides two functions to assess discrimination: <code><a href="../reference/calculate_auc.html">MiceExtVal::calculate_auc()</a></code> and <code><a href="../reference/calculate_harrell_c_index.html">MiceExtVal::calculate_harrell_c_index()</a></code>. The former computes the Area Under the Receiver Operating Characteristic Curve (AUC), which is appropriate for binary outcomes. The latter calculates Harrell’s C-index, which is typically used for survival data.</p>
<p>Since our outcome is binary (death within 30 days), we will use AUC as our measure of discrimination in this example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timi2_model</span> <span class="op">&lt;-</span> <span class="va">timi2_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_auc.html">calculate_auc</a></span><span class="op">(</span><span class="va">gusto_imp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">auc_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>  <span class="st">"%.3f (95%% CI %.3f, %.3f)"</span>,</span>
<span>  <span class="va">timi2_model</span><span class="op">$</span><span class="va">auc</span><span class="op">[</span><span class="st">"Estimate"</span><span class="op">]</span>,</span>
<span>  <span class="va">timi2_model</span><span class="op">$</span><span class="va">auc</span><span class="op">[</span><span class="st">"95% CI L"</span><span class="op">]</span>,</span>
<span>  <span class="va">timi2_model</span><span class="op">$</span><span class="va">auc</span><span class="op">[</span><span class="st">"95% CI U"</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>The model yields an AUC of 0.797 (95% CI 0.775, 0.819), which indicates a fairly good level of discrimination. As a second key component of model performance, we now assess calibration, which evaluates how closely the predicted probabilities agree with the observed outcomes.</p>
<p>Calibration is most commonly visualized using a calibration plot. In the <code>MiceExtVal</code> package, generating this plot is a two-step process: first, the calibration data must be computed; then, the plot itself can be created.</p>
<p>To compute the calibration data, the package provides two functions:</p>
<ul>
<li>
<code><a href="../reference/get_calibration_plot_data_prop.html">MiceExtVal::get_calibration_plot_data_prop()</a></code> estimates the observed risks using outcome proportions.</li>
<li>
<code><a href="../reference/get_calibration_plot_data_surv.html">MiceExtVal::get_calibration_plot_data_surv()</a></code> estimates observed risks using a Kaplan–Meier approach (for survival outcomes).</li>
</ul>
<p>Since we are validating a logistic regression model with a binary outcome, we use <code><a href="../reference/get_calibration_plot_data_prop.html">MiceExtVal::get_calibration_plot_data_prop()</a></code>.</p>
<p>In the code snippet below, we generate a calibration plot for the TIMI-II model. We use <code><a href="../reference/get_calibration_plot_data_prop.html">MiceExtVal::get_calibration_plot_data_prop()</a></code> to compute the calibration data, followed by <code><a href="../reference/get_calibration_plot.html">MiceExtVal::get_calibration_plot()</a></code> to create the plot itself. The plot is generated using the <code>ggplot2</code> package, allowing for full customization. In this example, we also apply a custom function, <code>clip_axis_plot()</code>, to adjust the plot limits.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clip_axis_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">plot</span>, <span class="va">limit</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plot</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">limit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">limit</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">timi2_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot_data_prop.html">get_calibration_plot_data_prop</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">gusto_imp</span>,</span>
<span>    n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"predictions_aggregated"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot.html">get_calibration_plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">clip_axis_plot</span><span class="op">(</span>limit <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-timi2-calplot" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-timi2-calplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started-logreg_files/figure-html/fig-timi2-calplot-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-timi2-calplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 1: Calibration plot of TIMI-II predictions
</figcaption></figure>
</div>
</div>
</div>
<p>In Figure <a href="#fig-timi2-calplot" class="quarto-xref">Figure 1</a>, we observe a well-calibrated model: the predicted risks align closely with the observed outcomes across most deciles of risk. In practice, this level of agreement may be considered sufficient, and no further recalibration would be necessary.</p>
<p>Another way of measuring the accuracy of the predictions of the model to the observed risk is the Brier score. This score is calculated following</p>
<p><span class="math display">\[
BS = \frac{1}{N}\sum^N_{t = 1}(f_t - o_t)^2
\]</span></p>
<p>where <span class="math inline">\(N\)</span> is the size of the population, <span class="math inline">\(f_t\)</span> is the model prediction for the patient <span class="math inline">\(t\)</span> and <span class="math inline">\(o_t\)</span> is the observed risk for the patient <span class="math inline">\(t\)</span> in this case <span class="math inline">\(0\)</span> if they suffer no event and <span class="math inline">\(1\)</span> otherwise. In the <code>MiceExtVal</code> package we have developed the function <code><a href="../reference/calculate_brier_score.html">MiceExtVal::calculate_brier_score</a></code> that help users to calculate the model brier score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timi2_model</span> <span class="op">&lt;-</span> <span class="va">timi2_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_brier_score.html">calculate_brier_score</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">gusto_imp</span>, type <span class="op">=</span> <span class="st">"predictions_aggregated"</span>, n_boot <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">brier_score_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>  <span class="st">"%.3f (95%% CI %.3f, %.3f)"</span>,</span>
<span>  <span class="va">timi2_model</span><span class="op">$</span><span class="va">brier_score</span><span class="op">[</span><span class="st">"Estimate"</span><span class="op">]</span>,</span>
<span>  <span class="va">timi2_model</span><span class="op">$</span><span class="va">brier_score</span><span class="op">[</span><span class="st">"95% CI L"</span><span class="op">]</span>,</span>
<span>  <span class="va">timi2_model</span><span class="op">$</span><span class="va">brier_score</span><span class="op">[</span><span class="st">"95% CI U"</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>The model yields an AUC of 0.052 (95% CI 0.045, 0.059) that demonstrait a fair accuracy between the model predictions and the observed risks. However, to fully demonstrate the functionality of the <code>MiceExtVal</code> package, we will proceed with recalibrating the model predictions. This allows us to show how recalibration can be implemented when needed and how it affects the model’s performance.</p>
</section><section class="level2"><h3 id="model-recalibration">Model Recalibration<a class="anchor" aria-label="anchor" href="#model-recalibration"></a>
</h3>
<p>The MiceExtVal package provides two distinct functions to perform recalibration of model predictions:</p>
<ul>
<li><code><a href="../reference/calculate_predictions_recalibrated_type_1.html">MiceExtVal::calculate_predictions_recalibrated_type_1()</a></code></li>
<li><code><a href="../reference/calculate_predictions_recalibrated_type_2.html">MiceExtVal::calculate_predictions_recalibrated_type_2()</a></code></li>
</ul>
<p>These functions apply two different recalibration strategies. Importantly, Type 1 and Type 2 recalibrations are independent approaches. They are not sequential steps nor refinements of one another, but alternative methods to adjust predicted risks based on the external dataset.</p>
<p>After recalibration, we reassess model calibration using updated calibration plots. However, we do not recalculate the AUC, since recalibration modifies the predicted probabilities but does not affect the model’s ability to rank individuals, and thus has no impact on discrimination.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timi2_model</span> <span class="op">&lt;-</span> <span class="va">timi2_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions_recalibrated_type_1.html">calculate_predictions_recalibrated_type_1</a></span><span class="op">(</span><span class="va">gusto_imp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions_recalibrated_type_2.html">calculate_predictions_recalibrated_type_2</a></span><span class="op">(</span><span class="va">gusto_imp</span><span class="op">)</span></span></code></pre></div>
</div>
<p>In the previous code snippet, both types of recalibrated predictions were computed simultaneously and stored within the model object. These recalibrated predictions are provided as aggregated values, meaning that each patient receives a single recalibrated risk estimate, pooled across the multiple imputations. The resulting predictions can be seen in <a href="#tbl-recal-example" class="quarto-xref">Table 5</a>.</p>
<p>In addition to the recalibrated predictions, the corresponding recalibration parameters—such as intercept and slope adjustments—are also saved within the model object. This design ensures that all relevant recalibration outputs are centralized and accessible for further analysis or reporting.</p>
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timi2_model</span><span class="op">$</span><span class="va">predictions_recal_type_1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">timi2_model</span><span class="op">$</span><span class="va">predictions_recal_type_2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="tbl-recal-example" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-recal-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 5: Recalibrated predictions
</figcaption><div aria-describedby="tbl-recal-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-recal-example" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-recal-example-1" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-recal-example-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Type 1 recalibration
</figcaption><div aria-describedby="tbl-recal-example-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-recal-example-1" class="table do-not-create-environment caption-top">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">prediction_type_1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0835158</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0448944</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.0141260</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0581123</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0261984</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.0276119</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-recal-example" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-recal-example-2" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-recal-example-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Type 2 recalibration
</figcaption><div aria-describedby="tbl-recal-example-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-recal-example-2" class="table do-not-create-environment caption-top">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">prediction_type_2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0828035</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0418574</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.0117352</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0555939</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0231448</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.0245219</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<p>The recalibration parameters obtained for this model are:</p>
<ul>
<li>Type 1 recalibration: <span class="math inline">\(\alpha_{\text{type1}} = -0.366\)</span>
</li>
<li>Type 2 recalibration: <span class="math inline">\(\alpha_{\text{type2}} = -0.179, \beta_{\text{overall}} = 1.096\)</span>
</li>
</ul>
<p>These parameters are automatically stored in the model object after recalibration. If you would like more details about how these recalibrated predictions are computed, please refer to the documentation for each function.</p>
<p>As mentioned earlier, recalibration does not affect model discrimination. This is because all predictions are shifted or scaled uniformly, preserving the model’s ability to rank individuals. However, recalibration does affect model calibration, since the predictions are explicitly adjusted to better reflect the observed outcome frequencies in the external cohort.</p>
<p>To visualize the effect of recalibration, we generate calibration plots using the same plotting functions introduced earlier. The only difference is specifying the type of recalibrated predictions we wish to plot. The following code snippet demonstrates how to generate calibration plots for both Type 1 and Type 2 recalibrated predictions.</p>
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timi2_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot_data_prop.html">get_calibration_plot_data_prop</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">gusto_imp</span>,</span>
<span>    n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"predictions_recal_type_1"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot.html">get_calibration_plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">clip_axis_plot</span><span class="op">(</span>limit <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span></span>
<span></span>
<span><span class="va">timi2_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot_data_prop.html">get_calibration_plot_data_prop</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">gusto_imp</span>,</span>
<span>    n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"predictions_recal_type_2"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot.html">get_calibration_plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">clip_axis_plot</span><span class="op">(</span>limit <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span></span></code></pre></div>
<div id="fig-timi2-recal-calplot" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-timi2-recal-calplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-timi2-recal-calplot" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-timi2-recal-calplot-1" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig"><div aria-describedby="fig-timi2-recal-calplot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started-logreg_files/figure-html/fig-timi2-recal-calplot-1.png" data-ref-parent="fig-timi2-recal-calplot" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-timi2-recal-calplot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Type 1 recalibration
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-timi2-recal-calplot" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-timi2-recal-calplot-2" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig"><div aria-describedby="fig-timi2-recal-calplot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started-logreg_files/figure-html/fig-timi2-recal-calplot-2.png" data-ref-parent="fig-timi2-recal-calplot" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-timi2-recal-calplot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Type 2 recalibration
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-timi2-recal-calplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 2: Calibration plot of recalibration predictions
</figcaption></figure>
</div>
<p>Even though the AUC does not change with the model recalibration the Brier score does change. The predictions should be more accurate to the observed risk after this recalibrations and therefore we should obtain better Brier scores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timi2_model</span> <span class="op">&lt;-</span> <span class="va">timi2_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_brier_score.html">calculate_brier_score</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">gusto_imp</span>, type <span class="op">=</span> <span class="st">"predictions_recal_type_1"</span>, n_boot <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_brier_score.html">calculate_brier_score</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">gusto_imp</span>, type <span class="op">=</span> <span class="st">"predictions_recal_type_2"</span>, n_boot <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">brier_score_type_1_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>  <span class="st">"%.3f (95%% CI %.3f, %.3f)"</span>,</span>
<span>  <span class="va">timi2_model</span><span class="op">$</span><span class="va">brier_score_type_1</span><span class="op">[</span><span class="st">"Estimate"</span><span class="op">]</span>,</span>
<span>  <span class="va">timi2_model</span><span class="op">$</span><span class="va">brier_score_type_1</span><span class="op">[</span><span class="st">"95% CI L"</span><span class="op">]</span>,</span>
<span>  <span class="va">timi2_model</span><span class="op">$</span><span class="va">brier_score_type_1</span><span class="op">[</span><span class="st">"95% CI U"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">brier_score_type_2_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>  <span class="st">"%.3f (95%% CI %.3f, %.3f)"</span>,</span>
<span>  <span class="va">timi2_model</span><span class="op">$</span><span class="va">brier_score_type_2</span><span class="op">[</span><span class="st">"Estimate"</span><span class="op">]</span>,</span>
<span>  <span class="va">timi2_model</span><span class="op">$</span><span class="va">brier_score_type_2</span><span class="op">[</span><span class="st">"95% CI L"</span><span class="op">]</span>,</span>
<span>  <span class="va">timi2_model</span><span class="op">$</span><span class="va">brier_score_type_2</span><span class="op">[</span><span class="st">"95% CI U"</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>The model obtains a Brier score of 0.051 (95% CI 0.044, 0.058) for the type 1 recalibration and 0.052 (95% CI 0.045, 0.060) for the type 2 recalibration technique. The results are pretty similar to the original model predictions Brier score 0.052 (95% CI 0.045, 0.059). This results are aligned to the good calibration of the original model predictions.</p>
</section></section><section class="section level2"><h2 id="comparing-models">Comparing models<a class="anchor" aria-label="anchor" href="#comparing-models"></a>
</h2>
<p>External validation is often performed not only to assess the performance of a single model, but also to compare multiple models within the same external cohort. This comparison can help determine which model performs best overall or within specific subgroups of interest.</p>
<p>In the previous sections, we demonstrated how to externally validate a single model using the MiceExtVal package. However, the package also includes functionality to facilitate comparisons between models, whether they differ in structure or are applied to different subgroups.</p>
<p>As an example, in this section we stratify the validation of the TIMI-II model by gender, comparing its performance separately for men and women patients. To do this, we need to define two distinct model objects—one for men and one for women. Although both models share the same formula, they must be created separately to allow storage and comparison of their respective results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timi2_model_men</span> <span class="op">&lt;-</span> <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/mv_model_logreg.html">mv_model_logreg</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">day30</span> <span class="op">~</span> <span class="fl">1.79</span> <span class="op">*</span> <span class="va">sho</span> <span class="op">+</span> <span class="fl">0.99</span> <span class="op">*</span> <span class="va">a65</span> <span class="op">+</span> <span class="fl">0.92</span> <span class="op">*</span> <span class="va">hig</span> <span class="op">+</span> <span class="fl">0.74</span> <span class="op">*</span> <span class="va">dia</span> <span class="op">+</span></span>
<span>    <span class="fl">0.69</span> <span class="op">*</span> <span class="va">hyp</span> <span class="op">+</span> <span class="fl">0.59</span> <span class="op">*</span> <span class="va">hrt</span> <span class="op">+</span> <span class="fl">0.53</span> <span class="op">*</span> <span class="va">ttr</span> <span class="op">+</span> <span class="fl">0.47</span> <span class="op">*</span> <span class="va">sex</span> <span class="op">-</span> <span class="fl">4.47</span></span>
<span><span class="op">)</span></span>
<span><span class="va">timi2_model_women</span> <span class="op">&lt;-</span> <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/mv_model_logreg.html">mv_model_logreg</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">day30</span> <span class="op">~</span> <span class="fl">1.79</span> <span class="op">*</span> <span class="va">sho</span> <span class="op">+</span> <span class="fl">0.99</span> <span class="op">*</span> <span class="va">a65</span> <span class="op">+</span> <span class="fl">0.92</span> <span class="op">*</span> <span class="va">hig</span> <span class="op">+</span> <span class="fl">0.74</span> <span class="op">*</span> <span class="va">dia</span> <span class="op">+</span></span>
<span>    <span class="fl">0.69</span> <span class="op">*</span> <span class="va">hyp</span> <span class="op">+</span> <span class="fl">0.59</span> <span class="op">*</span> <span class="va">hrt</span> <span class="op">+</span> <span class="fl">0.53</span> <span class="op">*</span> <span class="va">ttr</span> <span class="op">+</span> <span class="fl">0.47</span> <span class="op">*</span> <span class="va">sex</span> <span class="op">-</span> <span class="fl">4.47</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>We also need to stratify the cohort by sex in order to use this subcohorts as parameters for the prediction calculations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gusto_imp_men</span> <span class="op">&lt;-</span> <span class="va">gusto_imp</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">gusto_imp_women</span> <span class="op">&lt;-</span> <span class="va">gusto_imp</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<p>With the stratified cohorts and models defined, we can now calculate the performance results for each group. It is important to note that each model is evaluated using the corresponding subcohort. Specifically, the model <code>timi2_model_men</code> will only store and evaluate results from the <code>gusto_imp_men</code> subcohort, which includes only men patients. Similarly, the model for women will evaluate only the data from the <code>gusto_imp_women</code> subcohort. This ensures that the models are validated on the appropriate subset of the cohort, allowing for a fair comparison of performance between the genders.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timi2_model_men</span> <span class="op">&lt;-</span> <span class="va">timi2_model_men</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions.html">calculate_predictions</a></span><span class="op">(</span><span class="va">gusto_imp_men</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions_recalibrated_type_1.html">calculate_predictions_recalibrated_type_1</a></span><span class="op">(</span><span class="va">gusto_imp_men</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions_recalibrated_type_2.html">calculate_predictions_recalibrated_type_2</a></span><span class="op">(</span><span class="va">gusto_imp_men</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_auc.html">calculate_auc</a></span><span class="op">(</span><span class="va">gusto_imp_men</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_brier_score.html">calculate_brier_score</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">gusto_imp_men</span>, type <span class="op">=</span> <span class="st">"predictions_aggregated"</span>, n_boot <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_brier_score.html">calculate_brier_score</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">gusto_imp_men</span>, type <span class="op">=</span> <span class="st">"predictions_recal_type_1"</span>, n_boot <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_brier_score.html">calculate_brier_score</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">gusto_imp_men</span>, type <span class="op">=</span> <span class="st">"predictions_recal_type_2"</span>, n_boot <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">timi2_model_women</span> <span class="op">&lt;-</span> <span class="va">timi2_model_women</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions.html">calculate_predictions</a></span><span class="op">(</span><span class="va">gusto_imp_women</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions_recalibrated_type_1.html">calculate_predictions_recalibrated_type_1</a></span><span class="op">(</span><span class="va">gusto_imp_women</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions_recalibrated_type_2.html">calculate_predictions_recalibrated_type_2</a></span><span class="op">(</span><span class="va">gusto_imp_women</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_auc.html">calculate_auc</a></span><span class="op">(</span><span class="va">gusto_imp_women</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_brier_score.html">calculate_brier_score</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">gusto_imp_women</span>, type <span class="op">=</span> <span class="st">"predictions_aggregated"</span>, n_boot <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_brier_score.html">calculate_brier_score</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">gusto_imp_women</span>, type <span class="op">=</span> <span class="st">"predictions_recal_type_1"</span>, n_boot <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_brier_score.html">calculate_brier_score</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">gusto_imp_women</span>, type <span class="op">=</span> <span class="st">"predictions_recal_type_2"</span>, n_boot <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<section class="level2"><h3 id="calibration-comparison-stratified-calibration-plots">Calibration Comparison: Stratified Calibration Plots<a class="anchor" aria-label="anchor" href="#calibration-comparison-stratified-calibration-plots"></a>
</h3>
<p>Once the results from both stratified models are stored, we can begin comparing the model performances. A useful starting point is to compare the calibration plots for the different subgroups. Similar to individual calibration plots, we have two functions depending on how we want to estimate the observed risks:</p>
<ul>
<li>
<code><a href="../reference/get_stratified_calibration_plot_prop.html">MiceExtVal::get_stratified_calibration_plot_prop()</a></code> for estimating observed risks using outcome proportions.</li>
<li>
<code><a href="../reference/get_stratified_calibration_plot_surv.html">MiceExtVal::get_stratified_calibration_plot_surv()</a></code> for estimating risks using a Kaplan–Meier approach (typically for survival data).</li>
</ul>
<p>For our case, since we are working with a binary outcome and stratifying by sex, we only need to use <code><a href="../reference/get_stratified_calibration_plot_prop.html">MiceExtVal::get_stratified_calibration_plot_prop()</a></code>.</p>
<p>To generate the stratified calibration plot, you’ll need to pass several arguments to the function:</p>
<ul>
<li>The external validation data (e.g., <code>gusto_imp</code>)</li>
<li>The number of groups</li>
<li>The type of prediction (either recalibrated or original predictions)</li>
<li>A list of models to compare (in this case, <code>timi2_model_men</code> and <code>timi2_model_women</code>).</li>
</ul>
<p>This will allow the function to overlay calibration plots for both models on the same figure, facilitating direct comparison.</p>
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#|</span></span>
<span><span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_stratified_calibration_plot_prop.html">get_stratified_calibration_plot_prop</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">gusto_imp</span>,</span>
<span>  n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"predictions_aggregated"</span>,</span>
<span>  Men <span class="op">=</span> <span class="va">timi2_model_men</span>,</span>
<span>  Women <span class="op">=</span> <span class="va">timi2_model_women</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">clip_axis_plot</span><span class="op">(</span>limit <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span></span>
<span><span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_stratified_calibration_plot_prop.html">get_stratified_calibration_plot_prop</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">gusto_imp</span>,</span>
<span>  n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"predictions_recal_type_1"</span>,</span>
<span>  Men <span class="op">=</span> <span class="va">timi2_model_men</span>,</span>
<span>  Women <span class="op">=</span> <span class="va">timi2_model_women</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">clip_axis_plot</span><span class="op">(</span>limit <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span></span>
<span><span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_stratified_calibration_plot_prop.html">get_stratified_calibration_plot_prop</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">gusto_imp</span>,</span>
<span>  n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"predictions_recal_type_2"</span>,</span>
<span>  Men <span class="op">=</span> <span class="va">timi2_model_men</span>,</span>
<span>  Women <span class="op">=</span> <span class="va">timi2_model_women</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">clip_axis_plot</span><span class="op">(</span>limit <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="get-started-logreg_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="get-started-logreg_files/figure-html/unnamed-chunk-14-2.png" width="672"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="get-started-logreg_files/figure-html/unnamed-chunk-14-3.png" width="672"></p>
</div>
</div>
</div>
<p>Note that we pass the entire imputed dataset (<code>gusto_imp</code>) as an argument, even though each model only stores the results for its respective subcohort (men or women). This is necessary because the function needs access to the full dataset in order to correctly extract and process the relevant subcohort for each model. The function then uses the subcohort specified for each model (e.g., <code>gusto_imp_men</code> for men) to calculate the appropriate calibration data and generate the corresponding calibration plots.</p>
<p>By passing the complete dataset, the function ensures that the stratified calibration plots are generated correctly, comparing the models’ calibration in the context of the full cohort’s distribution of characteristics.</p>
</section><section class="level2"><h3 id="discrimination-comparison-forestplot">Discrimination Comparison: Forestplot<a class="anchor" aria-label="anchor" href="#discrimination-comparison-forestplot"></a>
</h3>
<p>The <code>MiceExtVal</code> package also includes functionality for generating a forest plot to compare the discrimination abilities of different models. In this example, we will visualize the AUC (Area Under the Curve), but the package also allows for the comparison of the Harrell C-Index in survival outcomes.</p>
<p>The forest plot generation process is split into two steps:</p>
<ol type="1">
<li>Data preparation: The first step generates the data that will be used in the forest plot.</li>
<li>Forest plot creation: The second step generates the actual plot from the prepared data.</li>
</ol>
<p>To compare different models, we can stratify the results by binding data from different subgroups (e.g., men and women patients). Models that share the same name across subgroups will be merged in the final forest plot, making it easy to compare the performance of the same model in different groups.</p>
<p>In the following example, we generate two separate strata for the same model, <code>TIMI-II</code>, one for men and one for women, and then we pass these strata to the forest plot function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot_data.html">get_forestplot_data</a></span><span class="op">(</span>strat <span class="op">=</span> <span class="st">"Men"</span>, type <span class="op">=</span> <span class="st">"auc"</span>, `TIMI-II` <span class="op">=</span> <span class="va">timi2_model_men</span><span class="op">)</span>,</span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot_data.html">get_forestplot_data</a></span><span class="op">(</span>strat <span class="op">=</span> <span class="st">"Women"</span>, type <span class="op">=</span> <span class="st">"auc"</span>, `TIMI-II` <span class="op">=</span> <span class="va">timi2_model_women</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot.html">get_forestplot</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="get-started-logreg_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the following example, we generate a single strat, labeled <code>Overall</code>, that combines the data from both models, one for men and one for women. This allows us to compare the performance of the two stratified models in a single forest plot.</p>
<p>Note that we have removed the legend from the plot, as we only have one strat. Since the legend would be redundant in this case, we have opted to exclude it. It’s worth noting that, as with any other <code>ggplot2</code> plot, the forest plot can be further customized. You can modify it in any way, such as by reintroducing the legend, adjusting colors, or tweaking other visual elements to fit your needs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fp</span> <span class="op">&lt;-</span> <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot_data.html">get_forestplot_data</a></span><span class="op">(</span></span>
<span>  strat <span class="op">=</span> <span class="st">"Overall"</span>, type <span class="op">=</span> <span class="st">"auc"</span>,</span>
<span>  `TIMI-II Men` <span class="op">=</span> <span class="va">timi2_model_men</span>, `TIMI-II Women` <span class="op">=</span> <span class="va">timi2_model_women</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot.html">get_forestplot</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fl">0.75</span>, digits <span class="op">=</span> <span class="fl">2</span>, table <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fp</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fp</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fp</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="get-started-logreg_files/figure-html/unnamed-chunk-16-1.png" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Finally, both concepts can be combined to generate a forest plot that compares multiple models across multiple strata. The following example demonstrates how to compare the general model with its stratified validation, allowing a side-by-side comparison of model performance across different subgroups and the overall cohort.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot_data.html">get_forestplot_data</a></span><span class="op">(</span></span>
<span>    strat <span class="op">=</span> <span class="st">"Overall"</span>, type <span class="op">=</span> <span class="st">"auc"</span>,</span>
<span>    `TIMI-II` <span class="op">=</span> <span class="va">timi2_model</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot_data.html">get_forestplot_data</a></span><span class="op">(</span></span>
<span>    strat <span class="op">=</span> <span class="st">"Men"</span>, type <span class="op">=</span> <span class="st">"auc"</span>, `TIMI-II strat` <span class="op">=</span> <span class="va">timi2_model_men</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot_data.html">get_forestplot_data</a></span><span class="op">(</span></span>
<span>    strat <span class="op">=</span> <span class="st">"Women"</span>, type <span class="op">=</span> <span class="st">"auc"</span>, `TIMI-II strat` <span class="op">=</span> <span class="va">timi2_model_women</span></span>
<span>  <span class="op">)</span>,</span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot.html">get_forestplot</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fl">0.75</span>, digits <span class="op">=</span> <span class="fl">2</span>, table <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="get-started-logreg_files/figure-html/unnamed-chunk-17-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<section class="level3"><h4 id="brier-score-comparison-forestplot">Brier Score Comparison: Forestplot<a class="anchor" aria-label="anchor" href="#brier-score-comparison-forestplot"></a>
</h4>
<p>The forestplot functions also allow us to generate the data from the Brier score results. The next code snippet generates a forestplot that compares the different Brier score in each model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot_data.html">get_forestplot_data</a></span><span class="op">(</span></span>
<span>    strat <span class="op">=</span> <span class="st">"Original"</span>, type <span class="op">=</span> <span class="st">"brier_score"</span>,</span>
<span>    Men <span class="op">=</span> <span class="va">timi2_model_men</span>, Women <span class="op">=</span> <span class="va">timi2_model_women</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot_data.html">get_forestplot_data</a></span><span class="op">(</span></span>
<span>    strat <span class="op">=</span> <span class="st">"Type 1 recalibration"</span>, type <span class="op">=</span> <span class="st">"brier_score_type_1"</span>,</span>
<span>    Men <span class="op">=</span> <span class="va">timi2_model_men</span>, Women <span class="op">=</span> <span class="va">timi2_model_women</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot_data.html">get_forestplot_data</a></span><span class="op">(</span></span>
<span>    strat <span class="op">=</span> <span class="st">"Type 2 recalibration"</span>, type <span class="op">=</span> <span class="st">"brier_score_type_2"</span>,</span>
<span>    Men <span class="op">=</span> <span class="va">timi2_model_men</span>, Women <span class="op">=</span> <span class="va">timi2_model_women</span></span>
<span>  <span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot.html">get_forestplot</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="st">"estimate"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, digit <span class="op">=</span> <span class="fl">2</span>, table <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-forestplot-brier-score" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-forestplot-brier-score-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started-logreg_files/figure-html/fig-forestplot-brier-score-1.png" width="1152">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-forestplot-brier-score-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 3: Forestplot Brier score comparison
</figcaption></figure>
</div>
</div>
</div>
</section></section><section class="level2 unnumbered"><h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-vanBuuren2018" class="csl-entry" role="listitem">
Buuren, S. van. (2018). <em>Flexible imputation of missing data, second edition</em>. Chapman; Hall/CRC. <a href="https://doi.org/10.1201/9780429492259" class="external-link">https://doi.org/10.1201/9780429492259</a>
</div>
<div id="ref-timi-ii" class="csl-entry" role="listitem">
Mueller, H. S., Cohen, L. S., Braunwald, E., Forman, S., Feit, F., Ross, A., Schweiger, M., Cabin, H., Davison, R., &amp; Miller, D. (1992). Predictors of early morbidity and mortality after thrombolytic therapy of acute myocardial infarction. Analyses of patient subgroups in the thrombolysis in myocardial infarction (TIMI) trial, phase II. <em>Circulation</em>, <em>85</em>(4), 1254–1264. <a href="https://doi.org/10.1161/01.CIR.85.4.1254" class="external-link">https://doi.org/10.1161/01.CIR.85.4.1254</a>
</div>
<div id="ref-steyerberg" class="csl-entry" role="listitem">
Steyerberg, E. W. (2019). Updating for a new setting. In <em>Clinical prediction models: A practical approach to development, validation, and updating</em> (pp. 399–429). Springer International Publishing. <a href="https://doi.org/10.1007/978-3-030-16399-0_20" class="external-link">https://doi.org/10.1007/978-3-030-16399-0_20</a>
</div>
<div id="ref-mice-package" class="csl-entry" role="listitem">
van Buuren, S., &amp; Groothuis-Oudshoorn, K. (2011). <span class="nocase">mice</span>: Multivariate imputation by chained equations in r. <em>Journal of Statistical Software</em>, <em>45</em>(3), 1–67. <a href="https://doi.org/10.18637/jss.v045.i03" class="external-link">https://doi.org/10.18637/jss.v045.i03</a>
</div>
</div>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Asier Ballesteros Domínguez.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
