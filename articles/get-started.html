<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MiceExtVal example of use • MiceExtVal</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><script src="get-started_files/libs/quarto-html/popper.min.js"></script><script src="get-started_files/libs/quarto-html/tippy.umd.min.js"></script><link href="get-started_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="get-started_files/libs/quarto-html/light-border.css" rel="stylesheet">
<script src="get-started_files/libs/kePrint-0.0.1/kePrint.js"></script><link href="get-started_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MiceExtVal example of use">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MiceExtVal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/get-started.html">MiceExtVal example of use</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/metodologianavarrabiomed/mice-ext-val/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>MiceExtVal example of use</h1>

      <p class="author">Asier Ballesteros Domínguez</p>


      <small class="dont-index">Source: <a href="https://github.com/metodologianavarrabiomed/mice-ext-val/blob/v0.0.1.1-alpha/vignettes/get-started.qmd" class="external-link"><code>vignettes/get-started.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="section level2"><h2 id="required-libraries">Required libraries<a class="anchor" aria-label="anchor" href="#required-libraries"></a>
</h2>
<p>The following code snippet lists all the libraries needed to run this report.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://metodologianavarrabiomed.github.io/mice-ext-val">MiceExtVal</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tidyverse packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># table formatting packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ddsjoberg/gtsummary" class="external-link">gtsummary</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># analysis required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amices/mice" class="external-link">mice</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></code></pre></div>
</div>
<p>As an example of the package <code>MiceExtVal</code> use we will externally validate the Framingham model, see <span class="citation" data-cites="framingham">Wilson et al. (<a href="#ref-framingham" role="doc-biblioref">1998</a>)</span>. We will use a dataset obtained from <a href="https://www.kaggle.com" class="external-link">kaggle</a>. The example of use will be structured as follows.</p>
<ol type="1">
<li>Explore the dataset</li>
<li>Impute the missing data</li>
<li>Define the Framingham model</li>
<li>Externally validate the model</li>
</ol></section><section class="section level2"><h2 id="explore-the-dataset">Explore the Dataset<a class="anchor" aria-label="anchor" href="#explore-the-dataset"></a>
</h2>
<p>To recreate an external validation of the Framingham model we need a dataset with the model variables. In the package we have included the Framingham dataset provided in <a href="https://www.kaggle.com" class="external-link">kaggle</a> by <a href="https://www.kaggle.com/datasets/shreyjain601/framingham-heart-study" class="external-link">Shrey Jain</a>. In <a href="#tbl-summary-data" class="quarto-xref">Table 1</a> there are represented the dataset variables.</p>
<div class="cell plain table-sm">
<div id="tbl-summary-data" class="cell plain table-sm quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-summary-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 1: Summary table of the Framingham dataset
</figcaption><div aria-describedby="tbl-summary-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="zxvnwwuqmk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zxvnwwuqmk table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zxvnwwuqmk thead, #zxvnwwuqmk tbody, #zxvnwwuqmk tfoot, #zxvnwwuqmk tr, #zxvnwwuqmk td, #zxvnwwuqmk th {
  border-style: none;
}

#zxvnwwuqmk p {
  margin: 0;
  padding: 0;
}

#zxvnwwuqmk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zxvnwwuqmk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zxvnwwuqmk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zxvnwwuqmk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zxvnwwuqmk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zxvnwwuqmk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zxvnwwuqmk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zxvnwwuqmk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zxvnwwuqmk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zxvnwwuqmk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zxvnwwuqmk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zxvnwwuqmk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zxvnwwuqmk .gt_spanner_row {
  border-bottom-style: hidden;
}

#zxvnwwuqmk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zxvnwwuqmk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zxvnwwuqmk .gt_from_md > :first-child {
  margin-top: 0;
}

#zxvnwwuqmk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zxvnwwuqmk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zxvnwwuqmk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zxvnwwuqmk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zxvnwwuqmk .gt_row_group_first td {
  border-top-width: 2px;
}

#zxvnwwuqmk .gt_row_group_first th {
  border-top-width: 2px;
}

#zxvnwwuqmk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zxvnwwuqmk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zxvnwwuqmk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zxvnwwuqmk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zxvnwwuqmk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zxvnwwuqmk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zxvnwwuqmk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zxvnwwuqmk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zxvnwwuqmk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zxvnwwuqmk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zxvnwwuqmk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zxvnwwuqmk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zxvnwwuqmk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zxvnwwuqmk .gt_left {
  text-align: left;
}

#zxvnwwuqmk .gt_center {
  text-align: center;
}

#zxvnwwuqmk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zxvnwwuqmk .gt_font_normal {
  font-weight: normal;
}

#zxvnwwuqmk .gt_font_bold {
  font-weight: bold;
}

#zxvnwwuqmk .gt_font_italic {
  font-style: italic;
}

#zxvnwwuqmk .gt_super {
  font-size: 65%;
}

#zxvnwwuqmk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zxvnwwuqmk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zxvnwwuqmk .gt_indent_1 {
  text-indent: 5px;
}

#zxvnwwuqmk .gt_indent_2 {
  text-indent: 10px;
}

#zxvnwwuqmk .gt_indent_3 {
  text-indent: 15px;
}

#zxvnwwuqmk .gt_indent_4 {
  text-indent: 20px;
}

#zxvnwwuqmk .gt_indent_5 {
  text-indent: 25px;
}

#zxvnwwuqmk .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#zxvnwwuqmk div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table do-not-create-environment cell plain table-sm small caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead><tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="stat_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">
<strong>No</strong><br> N = 8,469<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span>
</th>
<th id="stat_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">
<strong>Yes</strong><br> N = 3,158<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span>
</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">Sex, 1=male, 2=female</td>
<td class="gt_row gt_center" headers="stat_1"><br></td>
<td class="gt_row gt_center" headers="stat_2"><br></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    1</td>
<td class="gt_row gt_center" headers="stat_1">3,255 / 8,469 (38%)</td>
<td class="gt_row gt_center" headers="stat_2">1,767 / 3,158 (56%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">    2</td>
<td class="gt_row gt_center" headers="stat_1">5,214 / 8,469 (62%)</td>
<td class="gt_row gt_center" headers="stat_2">1,391 / 3,158 (44%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Age, years</td>
<td class="gt_row gt_center" headers="stat_1">53.83 (9.43)</td>
<td class="gt_row gt_center" headers="stat_2">57.36 (9.45)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Total cholesterol, mg/dL</td>
<td class="gt_row gt_center" headers="stat_1">238.08 (44.17)</td>
<td class="gt_row gt_center" headers="stat_2">249.42 (47.47)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    (Missing)</td>
<td class="gt_row gt_center" headers="stat_1">299</td>
<td class="gt_row gt_center" headers="stat_2">110</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">HDL cholesterol, mg/dL</td>
<td class="gt_row gt_center" headers="stat_1">50.66 (15.63)</td>
<td class="gt_row gt_center" headers="stat_2">45.61 (15.00)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    (Missing)</td>
<td class="gt_row gt_center" headers="stat_1">6,220</td>
<td class="gt_row gt_center" headers="stat_2">2,380</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">LDL cholesterol, mg/dL</td>
<td class="gt_row gt_center" headers="stat_1">174.04 (45.78)</td>
<td class="gt_row gt_center" headers="stat_2">183.49 (49.24)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    (Missing)</td>
<td class="gt_row gt_center" headers="stat_1">6,220</td>
<td class="gt_row gt_center" headers="stat_2">2,381</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Systolic Blood Pressure, mmHg</td>
<td class="gt_row gt_center" headers="stat_1">133.63 (21.57)</td>
<td class="gt_row gt_center" headers="stat_2">143.54 (24.38)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Diastolic Blood Pressure, mmHg</td>
<td class="gt_row gt_center" headers="stat_1">82.08 (11.18)</td>
<td class="gt_row gt_center" headers="stat_2">85.62 (12.51)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Currently smoking, 0=No, 1=Yes</td>
<td class="gt_row gt_center" headers="stat_1"><br></td>
<td class="gt_row gt_center" headers="stat_2"><br></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    0</td>
<td class="gt_row gt_center" headers="stat_1">4,804 / 8,469 (57%)</td>
<td class="gt_row gt_center" headers="stat_2">1,794 / 3,158 (57%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">    1</td>
<td class="gt_row gt_center" headers="stat_1">3,665 / 8,469 (43%)</td>
<td class="gt_row gt_center" headers="stat_2">1,364 / 3,158 (43%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Diabetes, 0=No, 1=Yes</td>
<td class="gt_row gt_center" headers="stat_1"><br></td>
<td class="gt_row gt_center" headers="stat_2"><br></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">    0</td>
<td class="gt_row gt_center" headers="stat_1">8,219 / 8,469 (97%)</td>
<td class="gt_row gt_center" headers="stat_2">2,878 / 3,158 (91%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">    1</td>
<td class="gt_row gt_center" headers="stat_1">250 / 8,469 (3.0%)</td>
<td class="gt_row gt_center" headers="stat_2">280 / 3,158 (8.9%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Time of follow up, days</td>
<td class="gt_row gt_center" headers="stat_1">8,063.37 (1,648.67)</td>
<td class="gt_row gt_center" headers="stat_2">4,178.32 (2,721.05)</td>
</tr>
</tbody>
<tfoot class="gt_footnotes"><tr class="odd">
<td colspan="3" class="gt_footnote">
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> n / N (%); Mean (SD)</td>
</tr></tfoot>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>In this dataset there exist some missing values in cholesterol related variables as <code>Total Cholesterol</code>, <code>HDL Cholesterol</code>, and <code>LDL Cholesterol</code>. In <a href="#tbl-perc-miss" class="quarto-xref">Table 2</a> there are represented the percentage o missings in the variables.</p>
<div class="cell plain table-sm">
<div id="tbl-perc-miss" class="cell plain table-sm quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-perc-miss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 2: Percentage of missings
</figcaption><div aria-describedby="tbl-perc-miss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell plain table-sm small caption-top" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Percentage of Missings</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ldlc</td>
<td style="text-align: center;">73.97</td>
</tr>
<tr class="even">
<td style="text-align: left;">hdlc</td>
<td style="text-align: center;">73.97</td>
</tr>
<tr class="odd">
<td style="text-align: left;">totchol</td>
<td style="text-align: center;">3.52</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section><section class="section level2"><h2 id="impute-missing-data">Impute Missing Data<a class="anchor" aria-label="anchor" href="#impute-missing-data"></a>
</h2>
<p>To ammend these missing values we will impute their expected values using the mice package, see <span class="citation" data-cites="mice-package">van Buuren &amp; Groothuis-Oudshoorn (<a href="#ref-mice-package" role="doc-biblioref">2011</a>)</span>. We will execute the default imputation as we are no interested in be so precise, we just want to reproduce an use case where we need to impute some missing data and from this data externally validate one or more models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_matrix</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://amices.org/mice/reference/make.predictorMatrix.html" class="external-link">make.predictorMatrix</a></span><span class="op">(</span><span class="fu">MiceExtVal</span><span class="fu">::</span><span class="va"><a href="../reference/framingham.html">framingham</a></span><span class="op">)</span></span>
<span><span class="va">pred_matrix</span><span class="op">[</span>, <span class="st">"randid"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">pred_matrix</span><span class="op">[</span>, <span class="st">"period"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">mice_data</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="fu">MiceExtVal</span><span class="fu">::</span><span class="va"><a href="../reference/framingham.html">framingham</a></span><span class="op">)</span></span>
<span><span class="va">fram_long</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span><span class="va">mice_data</span>, <span class="st">"long"</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="the-framingham-model">The Framingham Model<a class="anchor" aria-label="anchor" href="#the-framingham-model"></a>
</h2>
<p>With the data ready to be used we need to take some time to understand the model that we want to validate, the Framingham model, <span class="citation" data-cites="framingham">Wilson et al. (<a href="#ref-framingham" role="doc-biblioref">1998</a>)</span>. The Framingham is a Cox model that predicts the risk to suffer a coronary heart disease in patients that are <span class="math inline">\(30-79\)</span> years old, coefficients are represented in <a href="#tbl-framingham-coefficients" class="quarto-xref">Table 3</a>.</p>
<div class="cell plain table-sm" data-tbl.alt="Framingham model coefficients ">
<div id="tbl-framingham-coefficients" class="cell plain table-sm quarto-float quarto-figure quarto-figure-center" data-tbl.alt="Framingham model coefficients ">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-framingham-coefficients-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 3: Framingham model coefficients
</figcaption><div aria-describedby="tbl-framingham-coefficients-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell plain table-sm small caption-top" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Men</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Women</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Age, y</td>
<td style="text-align: center;">0.0483</td>
<td style="text-align: center;">0.3377</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age squared, y</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-0.0027</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Diabetes</td>
<td style="text-align: center;">0.4284</td>
<td style="text-align: center;">0.5963</td>
</tr>
<tr class="even">
<td style="text-align: left;">Smoker</td>
<td style="text-align: center;">0.5234</td>
<td style="text-align: center;">0.2925</td>
</tr>
<tr class="odd" data-grouplength="5">
<td colspan="3" style="text-align: left; border-bottom: 1px solid;">TC, mg/dL</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">&lt;160</td>
<td style="text-align: center;">-0.6594</td>
<td style="text-align: center;">-0.2614</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">160-199</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">200-239</td>
<td style="text-align: center;">0.1769</td>
<td style="text-align: center;">0.2077</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">240-279</td>
<td style="text-align: center;">0.5054</td>
<td style="text-align: center;">0.2439</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">&gt;280</td>
<td style="text-align: center;">0.6571</td>
<td style="text-align: center;">0.5351</td>
</tr>
<tr class="odd" data-grouplength="5">
<td colspan="3" style="text-align: left; border-bottom: 1px solid;">HDL-C, mg/dL</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">&lt;35</td>
<td style="text-align: center;">0.4974</td>
<td style="text-align: center;">0.8431</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">35-44</td>
<td style="text-align: center;">0.2431</td>
<td style="text-align: center;">0.3780</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">45-49</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">0.1978</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">50-59</td>
<td style="text-align: center;">-0.0511</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">&gt;60</td>
<td style="text-align: center;">-0.4866</td>
<td style="text-align: center;">-0.4295</td>
</tr>
<tr class="odd" data-grouplength="5">
<td colspan="3" style="text-align: left; border-bottom: 1px solid;">Blood Pressure</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Optimal</td>
<td style="text-align: center;">-0.0023</td>
<td style="text-align: center;">-0.5336</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Normal</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">High Normal</td>
<td style="text-align: center;">0.2832</td>
<td style="text-align: center;">-0.0677</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Stage I hypertension</td>
<td style="text-align: center;">0.5217</td>
<td style="text-align: center;">0.2629</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Stage II-IV hypertension</td>
<td style="text-align: center;">0.6186</td>
<td style="text-align: center;">0.4657</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Baseline survival function at 10 years, S(t)</td>
<td style="text-align: center;">0.9002</td>
<td style="text-align: center;">0.9625</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<section class="level2"><h3 id="requirements-to-define-the-model">Requirements to Define the Model<a class="anchor" aria-label="anchor" href="#requirements-to-define-the-model"></a>
</h3>
<p>In the dataset we have the information needed to predict the patient’s risk of event, but we need to define the variables exactly as they were defined in the Framingham derivation cohort. Therefore, before defining the model we need to generate the Framingham variables in our dataset. In the <a href="#tbl-framingham-coefficients" class="quarto-xref">Table 3</a> we can observe that some continous variables are converted into categorical. More precisely, the total cholesterol, HDL cholesterol and blood pressure are categorized.</p>
<section class="level3"><h4 id="total-cholesterol">Total Cholesterol<a class="anchor" aria-label="anchor" href="#total-cholesterol"></a>
</h4>
<p>The total cholesterol variable is categorized into five categories, less than 160 mg/dL, between 160 and 199 mg/dL, between 200 and 239 mg/dL, between 240 and 279 mg/dl, and more than 280 mg/dL. The following code snippet generates the variable in the dataset.</p>
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: center;">Men</th>
<th style="text-align: center;">Women</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>TC, mg/dL</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&lt;160</td>
<td style="text-align: center;">-0.6594</td>
<td style="text-align: center;">-0.2614</td>
</tr>
<tr class="odd">
<td style="text-align: left;">160-199</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">200-239</td>
<td style="text-align: center;">0.1769</td>
<td style="text-align: center;">0.2077</td>
</tr>
<tr class="odd">
<td style="text-align: left;">240-279</td>
<td style="text-align: center;">0.5054</td>
<td style="text-align: center;">0.2439</td>
</tr>
<tr class="even">
<td style="text-align: left;">&gt;280</td>
<td style="text-align: center;">0.6571</td>
<td style="text-align: center;">0.5351</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fram_long</span> <span class="op">&lt;-</span> <span class="va">fram_long</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    totchol_less_160 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">totchol</span> <span class="op">&lt;</span> <span class="fl">160</span><span class="op">)</span>,</span>
<span>    totchol_160_199 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">totchol</span> <span class="op">&gt;=</span> <span class="fl">160</span> <span class="op">&amp;</span> <span class="va">totchol</span> <span class="op">&lt;</span> <span class="fl">200</span><span class="op">)</span>,</span>
<span>    totchol_200_239 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">totchol</span> <span class="op">&gt;=</span> <span class="fl">200</span> <span class="op">&amp;</span> <span class="va">totchol</span> <span class="op">&lt;</span> <span class="fl">240</span><span class="op">)</span>,</span>
<span>    totchol_240_279 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">totchol</span> <span class="op">&gt;=</span> <span class="fl">240</span> <span class="op">&amp;</span> <span class="va">totchol</span> <span class="op">&lt;</span> <span class="fl">280</span><span class="op">)</span>,</span>
<span>    totchol_greater_280 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">totchol</span> <span class="op">&gt;=</span> <span class="fl">280</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h4 id="hdl-cholesterol">HDL cholesterol<a class="anchor" aria-label="anchor" href="#hdl-cholesterol"></a>
</h4>
<p>The Framingham model characterizes the HDL cholesterol into five groups, less than 35 mg/dL, between 35 and 44 mg/dL, between 45 and 49 mg/dL, between 50 and 59 mg/dL, and more than 60 mg/dL. As before the following code snippet generates the variable in the dataset.</p>
<table class="table plain table-sm small caption-top">
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: center;">Men</th>
<th style="text-align: center;">Women</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>HDL, mg/dL</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&lt;35</td>
<td style="text-align: center;">0.49744</td>
<td style="text-align: center;">0.84312</td>
</tr>
<tr class="odd">
<td style="text-align: left;">35-44</td>
<td style="text-align: center;">0.24310</td>
<td style="text-align: center;">0.37796</td>
</tr>
<tr class="even">
<td style="text-align: left;">45-49</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">0.19785</td>
</tr>
<tr class="odd">
<td style="text-align: left;">50-59</td>
<td style="text-align: center;">-0.05107</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">&gt;60</td>
<td style="text-align: center;">-0.48660</td>
<td style="text-align: center;">-0.42951</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fram_long</span> <span class="op">&lt;-</span> <span class="va">fram_long</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    hdl_less_35 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">hdlc</span> <span class="op">&lt;</span> <span class="fl">35</span><span class="op">)</span>,</span>
<span>    hdl_35_44 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">hdlc</span> <span class="op">&gt;=</span> <span class="fl">35</span> <span class="op">&amp;</span> <span class="va">hdlc</span> <span class="op">&lt;</span> <span class="fl">44</span><span class="op">)</span>,</span>
<span>    hdl_45_49 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">hdlc</span> <span class="op">&gt;=</span> <span class="fl">45</span> <span class="op">&amp;</span> <span class="va">hdlc</span> <span class="op">&lt;</span> <span class="fl">49</span><span class="op">)</span>,</span>
<span>    hdl_50_59 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">hdlc</span> <span class="op">&gt;=</span> <span class="fl">50</span> <span class="op">&amp;</span> <span class="va">hdlc</span> <span class="op">&lt;</span> <span class="fl">59</span><span class="op">)</span>,</span>
<span>    hdl_greater_60 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">hdlc</span> <span class="op">&gt;=</span> <span class="fl">60</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h4 id="blood-pressure">Blood pressure<a class="anchor" aria-label="anchor" href="#blood-pressure"></a>
</h4>
<p>In the model it is defined a variable that aggregates the systolyc blood pressure and diastolic blood pressure into five groups of hypertension. As defined by <span class="citation" data-cites="framingham">Wilson et al. (<a href="#ref-framingham" role="doc-biblioref">1998</a>)</span>, we categorize each of the individual blood pressure variables into five groups, optimal, normal, high-normal, hypertension I, and hypertension II-IV. If a patient have different blood pressure categories we use the highest one as a representation of they state. The following code adds the variable to the dataset, we first generate the individual categorization variables and generate the <code>pressure</code> variable as the aggregation of both.</p>
<table class="table plain table-sm small caption-top">
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Men</th>
<th style="text-align: left;">Women</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Blood Pressure</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Optimal</td>
<td style="text-align: left;">-0.00226</td>
<td style="text-align: left;">-0.53363</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Normal</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">High Normal</td>
<td style="text-align: left;">0.28320</td>
<td style="text-align: left;">-0.06773</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Stage I hypertension</td>
<td style="text-align: left;">0.52168</td>
<td style="text-align: left;">0.26288</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stage II-IV hypertension</td>
<td style="text-align: left;">0.61859</td>
<td style="text-align: left;">0.46573</td>
</tr>
</tbody>
</table>
<p>We first generate a variable called <code>pressure</code> that categorize both pressures into one variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pressure_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"optimal"</span>, <span class="st">"normal"</span>, <span class="st">"high-normal"</span>, <span class="st">"hypertension I"</span>, <span class="st">"hypertension II-IV"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fram_long</span> <span class="op">&lt;-</span> <span class="va">fram_long</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    sys_lvl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span></span>
<span>      <span class="va">sysbp</span>,</span>
<span>      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">120</span>, <span class="fl">130</span>, <span class="fl">140</span>, <span class="fl">160</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>      labels <span class="op">=</span> <span class="va">pressure_labels</span></span>
<span>    <span class="op">)</span>,</span>
<span>    dys_lvl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span></span>
<span>      <span class="va">diabp</span>,</span>
<span>      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">80</span>, <span class="fl">85</span>, <span class="fl">90</span>, <span class="fl">100</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>      labels <span class="op">=</span> <span class="va">pressure_labels</span></span>
<span>    <span class="op">)</span>,</span>
<span>    pressure <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_int</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sys_lvl</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">dys_lvl</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    pressure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">pressure</span>,</span>
<span>      labels <span class="op">=</span> <span class="va">pressure_labels</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<p>With the <code>pressure</code> variable we generate the variables used in the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fram_long</span> <span class="op">&lt;-</span> <span class="va">fram_long</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    bp_optimal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pressure</span> <span class="op">==</span> <span class="st">"optimal"</span><span class="op">)</span>,</span>
<span>    bp_high_normal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pressure</span> <span class="op">==</span> <span class="st">"high-normal"</span><span class="op">)</span>,</span>
<span>    bp_hypertension_i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pressure</span> <span class="op">==</span> <span class="st">"hypertension I"</span><span class="op">)</span>,</span>
<span>    bp_hypertension_ii_iv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pressure</span> <span class="op">==</span> <span class="st">"hypertension II-IV"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</section></section><section class="level2"><h3 id="selecting-the-needed-variables">Selecting the Needed Variables<a class="anchor" aria-label="anchor" href="#selecting-the-needed-variables"></a>
</h3>
<p>Once the Framingham variables are generated we need to create the model in the <code>MiceExtVal</code> package. The Framingham model is stratified by sex. Therefore, we need to generate two models, one for men and another for women The <code>MiceExtVal</code> package allow us to define a Cox model using the <code>mv_model_cox</code>.</p>
<section class="level3"><h4 id="generating-extra-needed-variables">Generating Extra Needed Variables<a class="anchor" aria-label="anchor" href="#generating-extra-needed-variables"></a>
</h4>
<p>Some variables like <code>cursmoke</code> or <code>diabetes</code> are factors and to be used in the model we need to transform them to numeric variables where <span class="math inline">\(1\)</span> indicates <code>TRUE</code> and <span class="math inline">\(0\)</span> indicates <code>FALSE</code>. We will also generate the variable <code>age2</code> <span class="math inline">\(age^2\)</span> needed for the women model. Additionally, we generate the survival outcome.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fram_long</span> <span class="op">&lt;-</span> <span class="va">fram_long</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    cursmoke <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">cursmoke</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span>,</span>
<span>    diabetes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">diabetes</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span>,</span>
<span>    age2 <span class="op">=</span> <span class="va">age</span><span class="op">**</span><span class="fl">2</span>,</span>
<span>    anychd_surv <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">timechd</span>, <span class="va">anychd</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<p>Finally, we generate the men and women datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">men_fram_long</span> <span class="op">&lt;-</span> <span class="va">fram_long</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">women_fram_long</span> <span class="op">&lt;-</span> <span class="va">fram_long</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h4 id="generate-the-models">Generate the models<a class="anchor" aria-label="anchor" href="#generate-the-models"></a>
</h4>
<p>The models in the package are created using the <code><a href="../reference/mv_model_cox.html">MiceExtVal::mv_model_cox</a></code> function if we want to externally validate a Cox model or <code><a href="../reference/mv_model_logreg.html">MiceExtVal::mv_model_logreg</a></code> if we want to validate a logistic regression model. In this case we want to validate the Framingham model that is a Cox model.</p>
<p>Each model needs different information in order to calculate the predictions in the Cox model we need to introduce the following parameters.</p>
<ul>
<li>
<code>formula</code>: A formula that defines the model. In this formula we need to define the model coefficients and if needed, like in this case, the means to center the variables in the <span class="math inline">\(\beta \cdot X\)</span> calculation.</li>
<li>
<code>S0</code>: The value of <span class="math inline">\(S_0(t)\)</span> for the time of study <span class="math inline">\(t\)</span> in the model. In this case <span class="math inline">\(t = 10 \text{ years}\)</span>.</li>
</ul>
<p>As the Framingham model is stratified by sex, we need to generate two models to externally validate it.</p>
<section class="level4"><h5 id="men">Men<a class="anchor" aria-label="anchor" href="#men"></a>
</h5>
<p>The next code snippet generates the men model formula following the original mean values and the coefficients described in the previous tables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">men_formula</span> <span class="op">&lt;-</span> <span class="va">anychd_surv</span> <span class="op">~</span> <span class="fl">0.0483</span> <span class="op">*</span> <span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">48.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">0.4284</span> <span class="op">*</span> <span class="op">(</span><span class="va">diabetes</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5234</span> <span class="op">*</span> <span class="op">(</span><span class="va">cursmoke</span> <span class="op">-</span> <span class="fl">0.403</span><span class="op">)</span> <span class="op">-</span></span>
<span>  <span class="fl">0.6595</span> <span class="op">*</span> <span class="op">(</span><span class="va">totchol_less_160</span> <span class="op">-</span> <span class="fl">0.075</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.1769</span> <span class="op">*</span> <span class="op">(</span><span class="va">totchol_200_239</span> <span class="op">-</span> <span class="fl">0.39</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">0.5054</span> <span class="op">*</span> <span class="op">(</span><span class="va">totchol_240_279</span> <span class="op">-</span> <span class="fl">0.165</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.6571</span> <span class="op">*</span> <span class="op">(</span><span class="va">totchol_greater_280</span> <span class="op">-</span> <span class="fl">0.057</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">0.4974</span> <span class="op">*</span> <span class="op">(</span><span class="va">hdl_less_35</span> <span class="op">-</span> <span class="fl">0.192</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.2431</span> <span class="op">*</span> <span class="op">(</span><span class="va">hdl_35_44</span> <span class="op">-</span> <span class="fl">0.357</span><span class="op">)</span> <span class="op">-</span></span>
<span>  <span class="fl">0.0511</span> <span class="op">*</span> <span class="op">(</span><span class="va">hdl_50_59</span> <span class="op">-</span> <span class="fl">0.19</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.4866</span> <span class="op">*</span> <span class="op">(</span><span class="va">hdl_greater_60</span> <span class="op">-</span> <span class="fl">0.106</span><span class="op">)</span> <span class="op">-</span></span>
<span>  <span class="fl">0.0023</span> <span class="op">*</span> <span class="op">(</span><span class="va">bp_optimal</span> <span class="op">-</span> <span class="fl">0.202</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.2832</span> <span class="op">*</span> <span class="op">(</span><span class="va">bp_high_normal</span> <span class="op">-</span> <span class="fl">0.202</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">0.5217</span> <span class="op">*</span> <span class="op">(</span><span class="va">bp_hypertension_i</span> <span class="op">-</span> <span class="fl">0.225</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">0.6186</span> <span class="op">*</span> <span class="op">(</span><span class="va">bp_hypertension_ii_iv</span> <span class="op">-</span> <span class="fl">0.128</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Once we have defined the needed parameters of the model we can create the model as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">men_model</span> <span class="op">&lt;-</span> <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/mv_model_cox.html">mv_model_cox</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">men_formula</span>,</span>
<span>  S0 <span class="op">=</span> <span class="fl">0.9002</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level4"><h5 id="women">Women<a class="anchor" aria-label="anchor" href="#women"></a>
</h5>
<p>For women we can reproduce what we have already done for men.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">women_formula</span> <span class="op">&lt;-</span> <span class="va">anychd_surv</span> <span class="op">~</span> <span class="fl">0.3377</span> <span class="op">*</span> <span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">49.6</span><span class="op">)</span> <span class="op">-</span></span>
<span>  <span class="fl">0.0027</span> <span class="op">*</span> <span class="op">(</span><span class="va">age2</span> <span class="op">-</span> <span class="fl">2604.5</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5963</span> <span class="op">*</span> <span class="op">(</span><span class="va">diabetes</span> <span class="op">-</span> <span class="fl">0.038</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">0.2925</span> <span class="op">*</span> <span class="op">(</span><span class="va">cursmoke</span> <span class="op">-</span> <span class="fl">0.378</span><span class="op">)</span> <span class="op">+</span> <span class="op">-</span><span class="fl">0.2614</span> <span class="op">*</span> <span class="op">(</span><span class="va">totchol_less_160</span> <span class="op">-</span> <span class="fl">0.079</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">0.2077</span> <span class="op">*</span> <span class="op">(</span><span class="va">totchol_200_239</span> <span class="op">-</span> <span class="fl">0.327</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.2439</span> <span class="op">*</span> <span class="op">(</span><span class="va">totchol_240_279</span> <span class="op">-</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">0.5351</span> <span class="op">*</span> <span class="op">(</span><span class="va">totchol_greater_280</span> <span class="op">-</span> <span class="fl">0.91</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.8431</span> <span class="op">*</span> <span class="op">(</span><span class="va">hdl_less_35</span> <span class="op">-</span> <span class="fl">0.043</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">0.378</span> <span class="op">*</span> <span class="op">(</span><span class="va">hdl_35_44</span> <span class="op">-</span> <span class="fl">0.149</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.1978</span> <span class="op">*</span> <span class="op">(</span><span class="va">hdl_45_49</span> <span class="op">-</span> <span class="fl">0.124</span><span class="op">)</span> <span class="op">-</span></span>
<span>  <span class="fl">0.4295</span> <span class="op">*</span> <span class="op">(</span><span class="va">hdl_greater_60</span> <span class="op">-</span> <span class="fl">0.407</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5336</span> <span class="op">*</span> <span class="op">(</span><span class="va">bp_optimal</span> <span class="op">-</span> <span class="fl">0.348</span><span class="op">)</span> <span class="op">-</span></span>
<span>  <span class="fl">0.0677</span> <span class="op">*</span> <span class="op">(</span><span class="va">bp_high_normal</span> <span class="op">-</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.2629</span> <span class="op">*</span> <span class="op">(</span><span class="va">bp_hypertension_i</span> <span class="op">-</span> <span class="fl">0.186</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">0.4657</span> <span class="op">*</span> <span class="op">(</span><span class="va">bp_hypertension_ii_iv</span> <span class="op">-</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
</div>
<p>From the previous parameters we generate the <code>women_model</code> to externally validate the Framingham women model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">women_model</span> <span class="op">&lt;-</span> <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/mv_model_cox.html">mv_model_cox</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">women_formula</span>,</span>
<span>  S0 <span class="op">=</span> <span class="fl">0.9625</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section></section></section></section><section class="section level2"><h2 id="external-validation">External validation<a class="anchor" aria-label="anchor" href="#external-validation"></a>
</h2>
<p>Once we have defined the Framingham model for the package we can now start to externally validate the model. The package functions are separated in two big groups, the functions that calculate predictions or results from the model definition are started by <code>calculate_</code>, and the functions that obtain external validation results are started by <code>get_</code>.</p>
<p>The external validation can be structured in three phases.</p>
<ol type="1">
<li>Calculate the predictions.</li>
<li>Calculate the recalibrations.</li>
<li>Obtain the external validation results.</li>
</ol>
<section class="level2"><h3 id="calculate-the-predictions">Calculate the predictions<a class="anchor" aria-label="anchor" href="#calculate-the-predictions"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">men_model</span> <span class="op">&lt;-</span> <span class="va">men_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions.html">calculate_predictions</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">_</span>, data <span class="op">=</span> <span class="va">men_fram_long</span><span class="op">)</span></span>
<span></span>
<span><span class="va">women_model</span> <span class="op">&lt;-</span> <span class="va">women_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions.html">calculate_predictions</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">_</span>, data <span class="op">=</span> <span class="va">women_fram_long</span><span class="op">)</span></span></code></pre></div>
</div>
<p>As a result inside the model there are generated two tables <code>predictions_data</code> and <code>predictions_aggregated</code>. In the next table there are shown the first rows of the <code>predictions_data</code> table, where there are all the predicted values for each of the imputations.</p>
<div class="cell plain table-sm">
<div id="tbl-pred-data" class="cell plain table-sm quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pred-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 4: Example of <code>predictions_data</code>
</figcaption><div aria-describedby="tbl-pred-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell plain table-sm small caption-top" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">prediction</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">.imp</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.051</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2448</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.122</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">9428</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.097</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">14367</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.168</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">16365</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.207</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">20375</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.154</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">33077</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>In this second table there are shown the first rows of <code>predictions_aggregated</code> where there are only one aggregated prediction for each patient.</p>
<div class="cell plain table-sm">
<div id="tbl-pred-agg" class="cell plain table-sm quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pred-agg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 5: Example of <code>predictions_aggregated</code>
</figcaption><div aria-describedby="tbl-pred-agg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell plain table-sm small caption-top" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">prediction</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2448</td>
<td style="text-align: right;">0.039</td>
</tr>
<tr class="even">
<td style="text-align: left;">9428</td>
<td style="text-align: right;">0.148</td>
</tr>
<tr class="odd">
<td style="text-align: left;">14367</td>
<td style="text-align: right;">0.154</td>
</tr>
<tr class="even">
<td style="text-align: left;">16365</td>
<td style="text-align: right;">0.162</td>
</tr>
<tr class="odd">
<td style="text-align: left;">20375</td>
<td style="text-align: right;">0.221</td>
</tr>
<tr class="even">
<td style="text-align: left;">33077</td>
<td style="text-align: right;">0.141</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section><section class="level2"><h3 id="model-performance">Model performance<a class="anchor" aria-label="anchor" href="#model-performance"></a>
</h3>
<p>The model performance can be separated in two. The ability of the model to discriminate high-risk patients from low-risk patients and its calibration i.e. the ability to match the real risk and predicted risk. The model C-Index is calculated using the Harrell’s C-Index and the calibration ability by generating calibration plots.</p>
<section class="level3"><h4 id="calculating-c-index">Calculating C-Index<a class="anchor" aria-label="anchor" href="#calculating-c-index"></a>
</h4>
<p>To calculate the Harrell C-Index the package provides the function <code>calculate_c_index</code>. This function requires that the model predictions are calculated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span> <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_c_index.html">calculate_c_index</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">_</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
<p>In our case we can calculate the C-Index as follows obtaining the results show in <a href="#tbl-c-index" class="quarto-xref">Table 6</a>.</p>
<div class="cell plain table-sm">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">men_model</span> <span class="op">&lt;-</span> <span class="va">men_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_c_index.html">calculate_c_index</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">_</span>, data <span class="op">=</span> <span class="va">men_fram_long</span><span class="op">)</span></span>
<span></span>
<span><span class="va">women_model</span> <span class="op">&lt;-</span> <span class="va">women_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_c_index.html">calculate_c_index</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">_</span>, data <span class="op">=</span> <span class="va">women_fram_long</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">men_model</span><span class="op">[[</span><span class="st">"c_index"</span><span class="op">]</span><span class="op">]</span>, <span class="va">women_model</span><span class="op">[[</span><span class="st">"c_index"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Men"</span>, <span class="st">"Women"</span><span class="op">)</span>, .before <span class="op">=</span> <span class="st">"Estimate"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div id="tbl-c-index" class="cell plain table-sm quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-c-index-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 6: C-Index results
</figcaption><div aria-describedby="tbl-c-index-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell plain table-sm small caption-top" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">95% CI L</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">95% CI U</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">P-val</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Men</td>
<td style="text-align: right;">0.687</td>
<td style="text-align: right;">0.661</td>
<td style="text-align: right;">0.713</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Women</td>
<td style="text-align: right;">0.711</td>
<td style="text-align: right;">0.687</td>
<td style="text-align: right;">0.736</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>In this article we also show how to recalibrate the model with the two techniques provided in the package. This recalibration of the predictions does not modify the value of the C-Index because all the predictions are modified using the same parameters of recalibration. As all the variable are modified equally the order of the predictions are not modified and therefore the C-Index remains unchanged.</p>
</section><section class="level3"><h4 id="calculating-calibration-plot">Calculating Calibration Plot<a class="anchor" aria-label="anchor" href="#calculating-calibration-plot"></a>
</h4>
<p>To calculate the calibration plots it is mandatory to have calculated before the model predictions or they recalibration if needed. The package provides the user with two functions that allow them to generate the calibration plots. The <code>get_calibration_plot_data</code> and the <code>get_calibration_plot</code> functions. The following code snippet shows how to calculate a calibration plot with the package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># only if needed</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions.html">calculate_predictions</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot_data.html">get_calibration_plot_data</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">_</span>,</span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"predictions_aggregated"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot.html">get_calibration_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span></code></pre></div>
</div>
<p>By using these functions we are able to generate the calibration plots shown in <a href="#fig-framingham-cal-plot" class="quarto-xref">Figure 1</a> as described in the following code snippet.</p>
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">men_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot_data.html">get_calibration_plot_data</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">_</span>,</span>
<span>    data <span class="op">=</span> <span class="va">men_fram_long</span>,</span>
<span>    n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"predictions_aggregated"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot.html">get_calibration_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span></span>
<span><span class="va">women_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot_data.html">get_calibration_plot_data</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">_</span>,</span>
<span>    data <span class="op">=</span> <span class="va">women_fram_long</span>,</span>
<span>    n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"predictions_aggregated"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot.html">get_calibration_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span></code></pre></div>
<div id="fig-framingham-cal-plot" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-framingham-cal-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-framingham-cal-plot" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-framingham-cal-plot-1" class="quarto-float quarto-figure quarto-figure-center" alt="Calibration plot for original predictions in men and women ">
<figure class="quarto-float quarto-subfloat-fig"><div aria-describedby="fig-framingham-cal-plot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started_files/figure-html/fig-framingham-cal-plot-1.png" data-ref-parent="fig-framingham-cal-plot" alt="Calibration plot for original predictions in men and women " width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-framingham-cal-plot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Men
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-framingham-cal-plot" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-framingham-cal-plot-2" class="quarto-float quarto-figure quarto-figure-center" alt="Calibration plot for original predictions in men and women ">
<figure class="quarto-float quarto-subfloat-fig"><div aria-describedby="fig-framingham-cal-plot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started_files/figure-html/fig-framingham-cal-plot-2.png" data-ref-parent="fig-framingham-cal-plot" alt="Calibration plot for original predictions in men and women " width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-framingham-cal-plot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Women
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-framingham-cal-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 1: Framingham original predictions calibration plots
</figcaption></figure>
</div>
<p>The calibration plots are a <code>ggplot</code> object and they can be modified as any other plot of the <code>ggplot2</code> package. Feel free to modify them to match your requirements.</p>
</section></section><section class="level2"><h3 id="recalibration">Recalibration<a class="anchor" aria-label="anchor" href="#recalibration"></a>
</h3>
<p>When we are validating a model in an external cohort is common that the model predictions do not match the observed risks in the new cohort. To minimize this problem we have developed two functions that allow the users to recalibrate the model predictions (please refer to <code>calculate_predictions_recalibrated_type_1</code> and <code>calculate_predictions_recalibrated_type_2</code> documentation for more detailed information on how the recalibration works).</p>
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">men_model</span> <span class="op">&lt;-</span> <span class="va">men_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions_recalibrated_type_1.html">calculate_predictions_recalibrated_type_1</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">_</span>, data <span class="op">=</span> <span class="va">men_fram_long</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions_recalibrated_type_2.html">calculate_predictions_recalibrated_type_2</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">_</span>, data <span class="op">=</span> <span class="va">men_fram_long</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">men_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot_data.html">get_calibration_plot_data</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">_</span>,</span>
<span>    data <span class="op">=</span> <span class="va">men_fram_long</span>,</span>
<span>    n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"predictions_recal_type_1"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot.html">get_calibration_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span></span>
<span><span class="va">men_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot_data.html">get_calibration_plot_data</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">_</span>,</span>
<span>    data <span class="op">=</span> <span class="va">men_fram_long</span>,</span>
<span>    n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"predictions_recal_type_2"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot.html">get_calibration_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span></code></pre></div>
<div id="fig-framingham-cal-plot-recal-men" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-framingham-cal-plot-recal-men-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-framingham-cal-plot-recal-men" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-framingham-cal-plot-recal-men-1" class="quarto-float quarto-figure quarto-figure-center" alt="Type 1 and type 2 calibration plots for men ">
<figure class="quarto-float quarto-subfloat-fig"><div aria-describedby="fig-framingham-cal-plot-recal-men-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started_files/figure-html/fig-framingham-cal-plot-recal-men-1.png" data-ref-parent="fig-framingham-cal-plot-recal-men" alt="Type 1 and type 2 calibration plots for men " width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-framingham-cal-plot-recal-men-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Type 1 recalibration
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-framingham-cal-plot-recal-men" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-framingham-cal-plot-recal-men-2" class="quarto-float quarto-figure quarto-figure-center" alt="Type 1 and type 2 calibration plots for men ">
<figure class="quarto-float quarto-subfloat-fig"><div aria-describedby="fig-framingham-cal-plot-recal-men-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started_files/figure-html/fig-framingham-cal-plot-recal-men-2.png" data-ref-parent="fig-framingham-cal-plot-recal-men" alt="Type 1 and type 2 calibration plots for men " width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-framingham-cal-plot-recal-men-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Type 2 recalibration
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-framingham-cal-plot-recal-men-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 2: Framingham recalibrated calibration plots in men
</figcaption></figure>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">women_model</span> <span class="op">&lt;-</span> <span class="va">women_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions_recalibrated_type_1.html">calculate_predictions_recalibrated_type_1</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">_</span>, data <span class="op">=</span> <span class="va">women_fram_long</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_predictions_recalibrated_type_2.html">calculate_predictions_recalibrated_type_2</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">_</span>, data <span class="op">=</span> <span class="va">women_fram_long</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">women_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot_data.html">get_calibration_plot_data</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">_</span>,</span>
<span>    data <span class="op">=</span> <span class="va">women_fram_long</span>,</span>
<span>    n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"predictions_recal_type_1"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot.html">get_calibration_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span></span>
<span><span class="va">women_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot_data.html">get_calibration_plot_data</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">_</span>,</span>
<span>    data <span class="op">=</span> <span class="va">women_fram_long</span>,</span>
<span>    n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"predictions_recal_type_2"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_calibration_plot.html">get_calibration_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span></code></pre></div>
<div id="fig-framingham-cal-plot-recal-women" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-framingham-cal-plot-recal-women-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-framingham-cal-plot-recal-women" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-framingham-cal-plot-recal-women-1" class="quarto-float quarto-figure quarto-figure-center" alt="Type 1 and type 2 calibration plots for women ">
<figure class="quarto-float quarto-subfloat-fig"><div aria-describedby="fig-framingham-cal-plot-recal-women-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started_files/figure-html/fig-framingham-cal-plot-recal-women-1.png" data-ref-parent="fig-framingham-cal-plot-recal-women" alt="Type 1 and type 2 calibration plots for women " width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-framingham-cal-plot-recal-women-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Type 1 recalibration
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-framingham-cal-plot-recal-women" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-framingham-cal-plot-recal-women-2" class="quarto-float quarto-figure quarto-figure-center" alt="Type 1 and type 2 calibration plots for women ">
<figure class="quarto-float quarto-subfloat-fig"><div aria-describedby="fig-framingham-cal-plot-recal-women-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started_files/figure-html/fig-framingham-cal-plot-recal-women-2.png" data-ref-parent="fig-framingham-cal-plot-recal-women" alt="Type 1 and type 2 calibration plots for women " width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-framingham-cal-plot-recal-women-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Type 2 recalibration
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-framingham-cal-plot-recal-women-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 3: Framingham recalibrated calibration plots in women
</figcaption></figure>
</div>
<p>Type 1 and type 2 recalibration are not consecutive, they are just two different approaches for the same problem. As show in <a href="#fig-framingham-cal-plot-recal-men" class="quarto-xref">Figure 2</a>, <a href="#fig-framingham-cal-plot-recal-women" class="quarto-xref">Figure 3</a> they obtain similar results.</p>
</section><section class="level2"><h3 id="comparing-results">Comparing results<a class="anchor" aria-label="anchor" href="#comparing-results"></a>
</h3>
<p>External validations are generally performed to obtain comparable results between different models. To accomplish this objective the model supplies two functions that allow to represent results of different models in the same plot, <code>get_stratified_calibration_plot</code> and <code>get_forestplot</code></p>
<section class="level3"><h4 id="stratified-calibration-plot">Stratified Calibration Plot<a class="anchor" aria-label="anchor" href="#stratified-calibration-plot"></a>
</h4>
<p>In order to compare two models calibration plots we have developed the function <code>get_stratified_calibration_plot</code> that allow the user to plot stratified calibration plots. In our case it could be interesting to plot men and women calibrations in the same plot, as shown in <a href="#fig-stratified-cal-plot" class="quarto-xref">Figure 4</a>.</p>
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_stratified_calibration_plot.html">get_stratified_calibration_plot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">fram_long</span>,</span>
<span>  n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"predictions_aggregated"</span>,</span>
<span>  Men <span class="op">=</span> <span class="va">men_model</span>,</span>
<span>  Women <span class="op">=</span> <span class="va">women_model</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_stratified_calibration_plot.html">get_stratified_calibration_plot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">fram_long</span>,</span>
<span>  n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"predictions_recal_type_1"</span>,</span>
<span>  Men <span class="op">=</span> <span class="va">men_model</span>,</span>
<span>  Women <span class="op">=</span> <span class="va">women_model</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_stratified_calibration_plot.html">get_stratified_calibration_plot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">fram_long</span>,</span>
<span>  n_groups <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"predictions_recal_type_2"</span>,</span>
<span>  Men <span class="op">=</span> <span class="va">men_model</span>,</span>
<span>  Women <span class="op">=</span> <span class="va">women_model</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div id="fig-stratified-cal-plot" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-stratified-cal-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-stratified-cal-plot" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-stratified-cal-plot-1" class="quarto-float quarto-figure quarto-figure-center" alt="Stratified calibration plot ">
<figure class="quarto-float quarto-subfloat-fig"><div aria-describedby="fig-stratified-cal-plot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started_files/figure-html/fig-stratified-cal-plot-1.png" data-ref-parent="fig-stratified-cal-plot" alt="Stratified calibration plot " width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-stratified-cal-plot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Original predictions
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-stratified-cal-plot" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-stratified-cal-plot-2" class="quarto-float quarto-figure quarto-figure-center" alt="Stratified calibration plot ">
<figure class="quarto-float quarto-subfloat-fig"><div aria-describedby="fig-stratified-cal-plot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started_files/figure-html/fig-stratified-cal-plot-2.png" data-ref-parent="fig-stratified-cal-plot" alt="Stratified calibration plot " width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-stratified-cal-plot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Type 1 recalibration
</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-stratified-cal-plot" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-stratified-cal-plot-3" class="quarto-float quarto-figure quarto-figure-center" alt="Stratified calibration plot ">
<figure class="quarto-float quarto-subfloat-fig"><div aria-describedby="fig-stratified-cal-plot-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started_files/figure-html/fig-stratified-cal-plot-3.png" data-ref-parent="fig-stratified-cal-plot" alt="Stratified calibration plot " width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-stratified-cal-plot-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Type 2 recalibration
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stratified-cal-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 4: Framingham stratified by sex calibration plots
</figcaption></figure>
</div>
</section><section class="level3"><h4 id="forestplot">Forestplot<a class="anchor" aria-label="anchor" href="#forestplot"></a>
</h4>
<p>The discrimination performance can be visualize as a foresplot. We have developed two functions that allow the users to generate foresplots where there can be visualized the model performance, see <a href="#fig-forestplot-stratified" class="quarto-xref">Figure 5</a>, <a href="#fig-forestplot-non-stratified" class="quarto-xref">Figure 6</a>.</p>
<p>To generate different strats we need to bind the outcomes of <code>get_forestplot_data</code> as many times as strats are needed in the forestplot. The names of the models must be the same in all the strats to be merged together. In this case we generate two strats with only one model in each of them but it is possible to add as many models as needed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot_data.html">get_forestplot_data</a></span><span class="op">(</span>strat <span class="op">=</span> <span class="st">"Men"</span>, Framingham <span class="op">=</span> <span class="va">men_model</span><span class="op">)</span>,</span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot_data.html">get_forestplot_data</a></span><span class="op">(</span>strat <span class="op">=</span> <span class="st">"Women"</span>, Framingham <span class="op">=</span> <span class="va">women_model</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot.html">get_forestplot</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-forestplot-stratified" class="quarto-float quarto-figure quarto-figure-center" alt="C-Indexes forestplot stratified ">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-forestplot-stratified-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started_files/figure-html/fig-forestplot-stratified-1.png" alt="C-Indexes forestplot stratified " width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-forestplot-stratified-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 5: Forestplot stratified
</figcaption></figure>
</div>
</div>
</div>
<p>If we want to generate a forestplot with multiple models in one strat we can generate it as the following example. In this example men and women models are inserted in the <code>Overall</code> strat as individual models. We have deleted the legend as it is not informative.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot_data.html">get_forestplot_data</a></span><span class="op">(</span></span>
<span>  strat <span class="op">=</span> <span class="st">"Overall"</span>,</span>
<span>  `Framingham Women` <span class="op">=</span> <span class="va">women_model</span>,</span>
<span>  `Framingham Men` <span class="op">=</span> <span class="va">men_model</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">MiceExtVal</span><span class="fu">::</span><span class="fu"><a href="../reference/get_forestplot.html">get_forestplot</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-forestplot-non-stratified" class="quarto-float quarto-figure quarto-figure-center" alt="C-Index forestplot with two models ">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-forestplot-non-stratified-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="get-started_files/figure-html/fig-forestplot-non-stratified-1.png" alt="C-Index forestplot with two models " width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-forestplot-non-stratified-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 6: Forestplot non-stratified
</figcaption></figure>
</div>
</div>
</div>
</section></section><section class="level2 unnumbered"><h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-mice-package" class="csl-entry" role="listitem">
van Buuren, S., &amp; Groothuis-Oudshoorn, K. (2011). <span class="nocase">mice</span>: Multivariate imputation by chained equations in r. <em>Journal of Statistical Software</em>, <em>45</em>(3), 1–67. <a href="https://doi.org/10.18637/jss.v045.i03" class="external-link">https://doi.org/10.18637/jss.v045.i03</a>
</div>
<div id="ref-framingham" class="csl-entry" role="listitem">
Wilson, P. W. F., D’Agostino, R. B., Levy, D., Belanger, A. M., Silbershatz, H., &amp; Kannel, W. B. (1998). Prediction of coronary heart disease using risk factor categories. <em>Circulation</em>, <em>97</em>(18), 1837–1847. <a href="https://doi.org/10.1161/01.CIR.97.18.1837" class="external-link">https://doi.org/10.1161/01.CIR.97.18.1837</a>
</div>
</div>
</section></section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Asier Ballesteros Domínguez.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
