#' @title
#' Calculate the predictions for a model
#'
#' @description
#' A generic method for calculating predictions for a given model. Further parameters must be passed to the S3 methods of each class ([calculate_predictions.cox()] and [calculate_predictions.logreg()])
#'
#' @param model A model generated by the function [mv_model_cox()] or [mv_model_logreg()]
#' @param data Data parameter for [calculate_predictions.cox()] or [calculate_predictions.logreg()]
#' @param .progress `TRUE` to render the progress bar `FALSE` otherwise.
#'
#' @return A model with the parameters `predictions_aggregated`, `predictions_data`, `betax` and `betax_data` populated.
#'
#' @export
#'
#' @examples
#' set.seed(123)
#'
#' model <- mv_model_logreg(formula = event ~ 0.5 * (x - 1) + 0.3 * (z - 2))
#'
#' data <- data.frame(
#'   .imp = c(1, 1, 1, 2, 2, 2, 3, 3, 3),
#'   id = c(1, 2, 3, 1, 2, 3, 1, 2, 3),
#'   event = survival::Surv(rpois(9, 5), rbinom(n = 9, size = 1, prob = 0.2)),
#'   x = rnorm(9, 1, 0.25),
#'   z = rnorm(9, 2, 0.75)
#' )
#'
#' model |> calculate_predictions(data)
calculate_predictions <- function(model, data, .progress = TRUE) {
  error_message <- NULL

  if (!methods::is(model, "MiceExtVal")) {
    error_message <- c(error_message, cli::format_error("{.arg model} must be of class {.arg MiceExtVal}"))
  }

  if (!methods::is(data, "data.frame")) {
    error_message <- c(error_message, cli::format_error("{.arg data} must be of class {.arg data.frame}"))
  }

  if (!is.null(error_message)) {
    names(error_message) <- rep("*", length(error_message))
    cli::cli_abort(error_message)
  }

  UseMethod("calculate_predictions", model)
}
